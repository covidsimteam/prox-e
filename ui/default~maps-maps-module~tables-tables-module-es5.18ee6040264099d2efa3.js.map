{"version":3,"sources":["webpack:///node_modules/pouchdb-utils/node_modules/uuid/lib/rng-browser.js","webpack:///node_modules/events/events.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/lib/bytesToUuid.js","webpack:///node_modules/argsarray/index.js","webpack:///node_modules/immediate/lib/timeout.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/index.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/v4.js","webpack:///node_modules/immediate/lib/mutation.js","webpack:///node_modules/lie/node_modules/immediate/lib/browser.js","webpack:///node_modules/url-parse/index.js","webpack:///node_modules/lie/lib/browser.js","webpack:///node_modules/inherits/inherits_browser.js","webpack:///node_modules/requires-port/index.js","webpack:///node_modules/url-join/lib/url-join.js","webpack:///node_modules/immediate/lib/queueMicrotask.js","webpack:///node_modules/spark-md5/spark-md5.js","webpack:///node_modules/vuvuzela/index.js","webpack:///node_modules/immediate/lib/index.js","webpack:///node_modules/pouchdb-authentication/node_modules/inherits/inherits_browser.js","webpack:///node_modules/immediate/lib/stateChange.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/v1.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/rng.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/bytesToUuid.js","webpack:///node_modules/pouchdb/lib/index-browser.es.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/v4.js","webpack:///node_modules/pouchdb-promise/lib/index.es.js","webpack:///node_modules/pouchdb-collections/lib/index.es.js","webpack:///node_modules/pouchdb-errors/lib/index.es.js","webpack:///node_modules/pouchdb-utils/lib/index-browser.es.js","webpack:///node_modules/pouchdb-ajax/lib/index-browser.es.js","webpack:///node_modules/pouchdb-binary-utils/lib/index-browser.es.js","webpack:///node_modules/pouchdb-authentication/lib/index.es.js","webpack:///src/app/services/logging.service.ts","webpack:///src/app/services/db/pouchdb.service.ts","webpack:///src/app/services/db/returnee.service.ts","webpack:///node_modules/querystringify/index.js","webpack:///node_modules/pouchdb-utils/node_modules/immediate/lib/browser.js","webpack:///node_modules/pouchdb-errors/node_modules/inherits/inherits_browser.js","webpack:///node_modules/immediate/lib/messageChannel.js","webpack:///node_modules/pouchdb-utils/node_modules/inherits/inherits_browser.js"],"names":["getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","module","exports","rnds","Array","r","i","Math","random","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","prototype","call","ownKeys","Object","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","value","EventEmitter","init","this","once","emitter","name","Promise","resolve","reject","eventListener","errorListener","removeListener","slice","arguments","err","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","create","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","arrayClone","listenerCount","n","copy","defineProperty","enumerable","get","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","handler","len","listeners","on","addListener","prependListener","prependOnceListener","off","list","position","originalListener","shift","index","pop","removeAllListeners","key","keys","rawListeners","eventNames","byteToHex","toString","substr","buf","offset","fun","test","install","t","setTimeout","v1","v4","uuid","rng","bytesToUuid","options","ii","Mutation","global","MutationObserver","WebKitMutationObserver","handle","called","observer","element","document","createTextNode","observe","characterData","data","scheduleDrain","draining","nextTick","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","required","qs","protocolre","slashes","rules","NaN","ignore","hash","query","lolcation","loc","finaldestination","location","protocol","URL","unescape","pathname","href","extractProtocol","address","match","exec","toLowerCase","rest","parser","relative","extracted","parse","instruction","instructions","url","indexOf","charAt","base","path","split","last","up","splice","join","port","host","hostname","username","password","auth","origin","part","fn","char","ins","stringify","result","immediate","INTERNAL","handlers","REJECTED","FULFILLED","PENDING","resolver","outcome","safelyResolveThenable","QueueItem","promise","onFulfilled","onRejected","callFulfilled","otherCallFulfilled","callRejected","otherCallRejected","func","returnValue","e","getThen","obj","then","self","thenable","onError","onSuccess","tryCatch","status","out","constructor","reason","all","iterable","values","resolved","allResolver","outValue","race","response","ctor","superCtor","super_","writable","configurable","TempCtor","normalize","strArray","resultArray","first","replace","component","str","parts","definition","queueMicrotask","undefined","hex_chr","md5cycle","x","k","a","b","c","d","md5blk","s","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","substring","parseInt","rhex","j","hex","toUtf8","encodeURIComponent","hexToBinaryString","bytes","fromCharCode","SparkMD5","reset","ArrayBuffer","clamp","val","max","min","from","to","num","targetArray","sourceArray","byteLength","begin","end","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","setState","destroy","hashBinary","content","second","buffer","subarray","returnUInt8Array","stack","metaStack","lastMetaElement","lastElementIndex","isArray","input","next","objPrefix","res","prefix","JSON","hasOwnProperty","collationIndex","parsedNum","numChar","parsedString","lastCh","numConsecutiveSlashes","ch","arrayElement","objElement","parseFloat","currentQueue","types","queueIndex","scheduled","cleanUpNextTick","timeout","run","clearTimeout","Item","array","_nodeId","_clockseq","_lastMSecs","_lastNSecs","node","clockseq","seedBytes","msecs","Date","getTime","nsecs","dt","tl","tmh","ExportedSet","ExportedMap","start","mangle","unmangle","Map$1","_store","Set$1","add","mangled","has","forEach","cb","size","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","hasLocal","funcToString","objectCtorString","clone","object","newObject","toISOString","Blob","webkitSlice","proto","Ctor","toPromise","usedCB","fulfill","resp","callback","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","taskqueue","isReady","addTask","failed","pick","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","allRequests","nextBatch","upTo","batch","docId","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","results","info","localStorage","setItem","getItem","hasLocalStorage","Changes","addEventListener","guardedConsole","method","defaultBackOff","maxTimeout","explainError","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","names","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","msg","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qParser","parseUri","uri","encoded","decodeURIComponent","$0","$1","$2","scopeEval","source","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","appendBlob","arrayBuffer","appendString","string","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","loadNextChunk","done","stringMd5","deterministic_revs","clonedDoc","_rev_tree","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","idx","mid","low","high","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","candidateParents","trees","diff","parent","parentIdx","elements","elementsLen","el","merge","depth","newTree","stemmed","stemmedRevs","revHash","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","p","TaskQueue","__opts","auto_compaction","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","_adapter","valid","fail","onDestroyed","from_constructor","onClosed","ready","_changesFilterPlugin","validate","doChanges","continuous","live","shouldFilter","descending","limit","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","missingObj","compactDocument","maxHeight","revTree","height","edges","prnt","edge","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","last_seq","_compact","promises","return_docs","row","_getLocal","finishOpenRevs","latest","l","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","_allDocs","close","_close","_info","db_name","_type","attachmentError","atts","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","_destroy","localDoc","PouchDB","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","getFieldFromDoc","parsedField","parseField","fieldName","fields","current","Pouch","destructListeners","_destructionListeners","dbList","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","$gte","$gt","$lte","$lt","$ne","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","collate","normalizeKey","ai","bi","ak","bk","Infinity","origKey","toJSON","toIndexableString","expFormat","toExponential","magnitude","neg","padWith","upToLength","padding","targetLength","factor","abs","toFixed","objKey","parseNumber","originalIdx","numAsString","magAsString","rowFilter","inMemoryFields","every","docFieldValue","some","orMatchers","find","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","neValue","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","rows","requestDef","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","filterName","filterFun","filters","toObject","reduce","version","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","specialKey","preprocessAttachment","blobType","asBinary","digest","md5","DOC_STORE","META_STORE","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","checkDone","attObj","objectStore","onsuccess","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","openCursor","only","event","cursor","digestSeq","primaryKey","openTransactionSafely","idb","stores","mode","transaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","code","lowerBound","running","applyNext","blobSupportPromise","cachedDBs","openReqList","IdbPouch","action","addDeletedOrLocalIndex","docStore","createIndex","unique","migrateLocalStore","localStore","local","docIdRev","range","seqCursor","migrateAttsAndSeqs","digestMap","digests","migrateMetadata","bySeqStore","onGetMetadataSeq","metadataSeq","metadataToStore","_meta","instanceId","reqOpts","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","docInfos","allDocsProcessed","docCountDelta","fetchedDocs","preconditionErrored","onAllDocsProcessed","updateDocCountIfReady","docCount","writeDoc","docInfo","winningRev$$1","winningRevIsDeleted","newRevIsDeleted","isUpdate","delta","resultsIdx","collectResults","finishDoc","attachmentSaved","afterPutDoc","revsToDelete","afterPutMetadata","attsAdded","attsToAdd","onerror","preventDefault","stopPropagation","putReq","overallErr","docv","recv","processedAttachment","blobSupport","txnResult","onabort","ontimeout","oncomplete","finish","filename","attErr","numFetched","readMetadata","revLimit","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","prev","splitRev","targetPos","targetId","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","revs_limit","historyNode","attachId","attachment","blobData","updateSeq","doc_count","idb_attachment_format","keyRangeError","inclusiveEnd","upperBound","inclusive_end","onResultsReady","docIdRevIndex","allDocsInner","processBatch","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","docIds","numResults","docIdsToMetadata","onGetMetadata","objectStores","winningDocs","metadatas","winningDoc","processMetadataAndWinningDoc","filtered","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","supportsBulkGetMap","encodeDocId","preprocessAttachments$1","genDBUrl","genUrl","paramsToStr","params","HttpPouch","user","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","now","adapterFun$$1","setup","fetchJSON","v","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","promiseFactories","filenames","typeFieldDescriptor","__proto__","doNext","runNextBatch","thisErr","docOrDocs","contentType","process","browser","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","fetchData","aborted","fetchOpts","signal","fetched","raw_results_length","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","parseViewName","emitError","builtInReduce","sumsqr","_sumsqr","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group","group_level","optionName","number","defaultsTo","getQueue","updateView","mapResults","origMap","currentSeq","processNextBatch","docIdsToChangesAndEmits","indexableKeysToKeyValues","createIndexableKeysToKeyValues","metaDocId","defaultMetaDoc","docData","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","listOfDocsToPersist","docsToPersist","emittedKeyValue","complexKey","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedStr","onMapResultsReady","finalResults","shouldGroup","reduceFunString","groups","lvl","POSITIVE_INFINITY","groupKey","reduceTry","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","_query","keysAsString","finalPromiseFactory","stale","viewCleanup","_viewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","mapreduce","isGenOne$1","getDocAttachments","updateCheckpoint","checkpoint","session","session_id","replicator","Checkpointer","src","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","sessionId","props","floor","Replication","toPouch","PouchConstructor","replicateWrapper","retry","replicateRet","replicate","currentBatch","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","queryParams","filterViewName","queryData","md5sum","writeDocs","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","diffs","resultDocs","bulkGetOpts","missingRev","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","Boolean","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","back_off_function","backOffSet","current_back_off","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","getCheckpoint","_addedListeners","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","success","_readyCalled","replicateMethods","other","isChromeApp","chrome","storage","onChanged","newValue","window","attachEvent","assign$1","hasXhr","XMLHttpRequest","isSafari","shouldCacheBust","cache","hasArgs","processData","Accept","encoding","xhr","timer","timedout","timeoutReq","cleanUp","onprogress","upload","exception","withCredentials","responseType","setRequestHeader","readyState","statusCode","getResponseHeader","responseText","FileReaderSync","send","wrappedPromise","fetchOptions","fetchResponse","text","ajaxCore","getBaseUrl","getUrl","parentPath","getConfigUrl","nodeName","getUsersUrl","getSessionUrl","getBasicAuthHeaders","Authorization","wrapError","AuthError","getMembership","ajaxOpts","ajax","signUpAdmin","membership","all_nodes","configUrl","deleteAdmin","logIn","logOut","getSession","reservedWords","roles","signUp","getUser","putUser","deleteUser","changePassword","changeUsername","oldUsername","newUsername","updateUser","taken","newUser","login","logout","getUsersDatabaseUrl","signup","LoggingService","PouchDBService","environment","logger","authService","databases","getDBInstance","instance","remoteInstance","getRemoteDBInstance","remoteDB","localDB","dbInstance","_","update","dbUri","isAuthenticated","pass","subscribe","getChangeListener","dbMeta","emitOnChange","ReturneeService","dbService","returneeDB","returnees","remoteSync","locAllDocs","requestQuery","addAll","returneeHeaders_","decode","pairs"],"mappings":"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","file":"x","sourcesContent":["// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function eventListener() {\n      if (errorListener !== undefined) {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n    var errorListener;\n\n    // Adding an error listener is not optional because\n    // if an error is thrown on an event emitter we cannot\n    // guarantee that the actual event we are waiting will\n    // be fired. The result could be a silent way to create\n    // memory or file descriptor leaks, which is something\n    // we should avoid.\n    if (name !== 'error') {\n      errorListener = function errorListener(err) {\n        emitter.removeListener(name, eventListener);\n        reject(err);\n      };\n\n      emitter.once('error', errorListener);\n    }\n\n    emitter.once(name, eventListener);\n  });\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nexports.test = function () {\n  return true;\n};\n\nexports.install = function (t) {\n  return function () {\n    setTimeout(t, 0);\n  };\n};","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","'use strict';\n//based off rsvp https://github.com/tildeio/rsvp.js\n//license https://github.com/tildeio/rsvp.js/blob/master/LICENSE\n//https://github.com/tildeio/rsvp.js/blob/master/lib/rsvp/asap.js\n\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nexports.test = function () {\n  return Mutation;\n};\n\nexports.install = function (handle) {\n  var called = 0;\n  var observer = new Mutation(handle);\n  var element = global.document.createTextNode('');\n  observer.observe(element, {\n    characterData: true\n  });\n  return function () {\n    element.data = (called = ++called % 2);\n  };\n};","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","'use strict';\n\nvar required = require('requires-port')\n  , qs = require('querystringify')\n  , protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i\n  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @api public\n */\nfunction lolcation(loc) {\n  loc = loc || global.location || {};\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new URL(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new URL(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) continue;\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @return {ProtocolExtract} Extracted information.\n * @api private\n */\nfunction extractProtocol(address) {\n  var match = protocolre.exec(address);\n\n  return {\n    protocol: match[1] ? match[1].toLowerCase() : '',\n    slashes: !!match[2],\n    rest: match[3]\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @api private\n */\nfunction resolve(relative, base) {\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) unshift = true;\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) path.unshift('');\n  if (last === '.' || last === '..') path.push('');\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} location Location defaults for relative paths.\n * @param {Boolean|Function} parser Parser for the query string.\n * @api public\n */\nfunction URL(address, location, parser) {\n  if (!(this instanceof URL)) {\n    return new URL(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) parser = qs.parse;\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '');\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (!extracted.slashes) instructions[2] = [/(.*)/, 'pathname'];\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) url[key] = url[key].toLowerCase();\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL}\n * @api public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || qs.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!required(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) value += ':'+ url.port;\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    default:\n      url[part] = value;\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String}\n * @api public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';\n\n  var result = protocol + (url.slashes ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  }\n\n  result += url.host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n}\n\nURL.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nURL.extractProtocol = extractProtocol;\nURL.location = lolcation;\nURL.qs = qs;\n\nmodule.exports = URL;\n","'use strict';\nvar immediate = require('immediate');\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n","(function (name, context, definition) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = definition();\n  else if (typeof define === 'function' && define.amd) define(definition);\n  else context[name] = definition();\n})('urljoin', this, function () {\n\n  function normalize (strArray) {\n    var resultArray = [];\n\n    // If the first part is a plain protocol, we combine it with the next part.\n    if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n      var first = strArray.shift();\n      strArray[0] = first + strArray[0];\n    }\n\n    // There must be two or three slashes in the file protocol, two slashes in anything else.\n    if (strArray[0].match(/^file:\\/\\/\\//)) {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n    } else {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n    }\n\n    for (var i = 0; i < strArray.length; i++) {\n      var component = strArray[i];\n\n      if (typeof component !== 'string') {\n        throw new TypeError('Url must be a string. Received ' + component);\n      }\n\n      if (component === '') { continue; }\n\n      if (i > 0) {\n        // Removing the starting slashes for each component but the first.\n        component = component.replace(/^[\\/]+/, '');\n      }\n      if (i < strArray.length - 1) {\n        // Removing the ending slashes for each component but the last.\n        component = component.replace(/[\\/]+$/, '');\n      } else {\n        // For the last component we will combine multiple slashes to a single one.\n        component = component.replace(/[\\/]+$/, '/');\n      }\n\n      resultArray.push(component);\n\n    }\n\n    var str = resultArray.join('/');\n    // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n    // remove trailing slash before parameters or hash\n    str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n    // replace ? in parameters with &\n    var parts = str.split('?');\n    str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n    return str;\n  }\n\n  return function () {\n    var input;\n\n    if (typeof arguments[0] === 'object') {\n      input = arguments[0];\n    } else {\n      input = [].slice.call(arguments);\n    }\n\n    return normalize(input);\n  };\n\n});\n","'use strict';\nexports.test = function () {\n  return typeof global.queueMicrotask === 'function';\n};\n\nexports.install = function (func) {\n  return function () {\n    global.queueMicrotask(func);\n  };\n};\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","'use strict';\nvar types = [\n  require('./nextTick'),\n  require('./queueMicrotask'),\n  require('./mutation.js'),\n  require('./messageChannel'),\n  require('./stateChange'),\n  require('./timeout')\n];\nvar draining;\nvar currentQueue;\nvar queueIndex = -1;\nvar queue = [];\nvar scheduled = false;\nfunction cleanUpNextTick() {\n  if (!draining || !currentQueue) {\n    return;\n  }\n  draining = false;\n  if (currentQueue.length) {\n    queue = currentQueue.concat(queue);\n  } else {\n    queueIndex = -1;\n  }\n  if (queue.length) {\n    nextTick();\n  }\n}\n\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  if (draining) {\n    return;\n  }\n  scheduled = false;\n  draining = true;\n  var len = queue.length;\n  var timeout = setTimeout(cleanUpNextTick);\n  while (len) {\n    currentQueue = queue;\n    queue = [];\n    while (currentQueue && ++queueIndex < len) {\n      currentQueue[queueIndex].run();\n    }\n    queueIndex = -1;\n    len = queue.length;\n  }\n  currentQueue = null;\n  queueIndex = -1;\n  draining = false;\n  clearTimeout(timeout);\n}\nvar scheduleDrain;\nvar i = -1;\nvar len = types.length;\nwhile (++i < len) {\n  if (types[i] && types[i].test && types[i].test()) {\n    scheduleDrain = types[i].install(nextTick);\n    break;\n  }\n}\n// v8 likes predictible objects\nfunction Item(fun, array) {\n  this.fun = fun;\n  this.array = array;\n}\nItem.prototype.run = function () {\n  var fun = this.fun;\n  var array = this.array;\n  switch (array.length) {\n  case 0:\n    return fun();\n  case 1:\n    return fun(array[0]);\n  case 2:\n    return fun(array[0], array[1]);\n  case 3:\n    return fun(array[0], array[1], array[2]);\n  default:\n    return fun.apply(null, array);\n  }\n\n};\nmodule.exports = immediate;\nfunction immediate(task) {\n  var args = new Array(arguments.length - 1);\n  if (arguments.length > 1) {\n    for (var i = 1; i < arguments.length; i++) {\n      args[i - 1] = arguments[i];\n    }\n  }\n  queue.push(new Item(task, args));\n  if (!scheduled && !draining) {\n    scheduled = true;\n    scheduleDrain();\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\n\nexports.test = function () {\n  return 'document' in global && 'onreadystatechange' in global.document.createElement('script');\n};\n\nexports.install = function (handle) {\n  return function () {\n\n    // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n    // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n    var scriptEl = global.document.createElement('script');\n    scriptEl.onreadystatechange = function () {\n      handle();\n\n      scriptEl.onreadystatechange = null;\n      scriptEl.parentNode.removeChild(scriptEl);\n      scriptEl = null;\n    };\n    global.document.documentElement.appendChild(scriptEl);\n\n    return handle;\n  };\n};","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  return (bth[buf[i + 0]] + bth[buf[i + 1]] + bth[buf[i + 2]] + bth[buf[i + 3]] + '-' + bth[buf[i + 4]] + bth[buf[i + 5]] + '-' + bth[buf[i + 6]] + bth[buf[i + 7]] + '-' + bth[buf[i + 8]] + bth[buf[i + 9]] + '-' + bth[buf[i + 10]] + bth[buf[i + 11]] + bth[buf[i + 12]] + bth[buf[i + 13]] + bth[buf[i + 14]] + bth[buf[i + 15]]).toLowerCase();\n}\n\nexport default bytesToUuid;","import immediate from 'immediate';\nimport { v4 } from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport EE from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EE);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EE.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EE.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    var names = Object.getOwnPropertyNames(error);\n    for (var i = 0, len = names.length; i < len; i++) {\n      if (typeof error[names[i]] !== 'function') {\n        this[names[i]] = error[names[i]];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EE.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = self.setImmediate || self.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EE);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EE.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EE);\n\nfunction AbstractPouchDB() {\n  EE.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EE();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EE.prototype).forEach(function (key) {\n    if (typeof EE.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.2\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EE);\nfunction Replication() {\n  EE.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EE);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js';\n\nfunction v4(options, buf, offset) {\n  if (typeof options === 'string') {\n    buf = options === 'binary' ? new Uint8Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    var start = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[start + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return bytesToUuid(rnds);\n}\n\nexport default v4;","import lie from 'lie';\n\n/* istanbul ignore next */\nvar PouchPromise = typeof Promise === 'function' ? Promise : lie;\n\nexport default PouchPromise;\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n/* global Map,Set */\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","import getArguments from 'argsarray';\nimport Promise from 'pouchdb-promise';\nimport { Map } from 'pouchdb-collections';\nimport immediate from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nfunction isChromeApp() {\n  return (typeof chrome !== \"undefined\" &&\n    typeof chrome.storage !== \"undefined\" &&\n    typeof chrome.storage.local !== \"undefined\");\n}\n\nvar hasLocal;\n\nif (isChromeApp()) {\n  hasLocal = false;\n} else {\n  try {\n    localStorage.setItem('_pouch_check_localstorage', 1);\n    hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n  } catch (e) {\n    hasLocal = false;\n  }\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n// avoid using process.nextTick() directly because the polyfill is very large and we don't\n// need all of it (see: https://github.com/defunctzombie/node-process).\n// \"immediate\" 3.0.8 is used by lie, and it's a smaller version of the latest \"immediate\"\n// package, so it's the one we use.\n// When we use nextTick() in our codebase, we only care about not releasing Zalgo\n// (see: http://blog.izs.me/post/59142742143/designing-apis-for-asynchrony).\n// Microtask vs macrotask doesn't matter to us. So we're free to use the fastest\n// (least latency) option, which is \"immediate\" due to use of microtasks.\n// All of our nextTicks are isolated to this one function so we can easily swap out one\n// implementation for another.\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (isChromeApp()) {\n    chrome.storage.onChanged.addListener(function (e) {\n      // make sure it's event addressed to us\n      if (e.db_name != null) {\n        //object only has oldValue, newValue members\n        self.emit(e.dbName.newValue);\n      }\n    });\n  } else if (hasLocalStorage()) {\n    if (typeof addEventListener !== 'undefined') {\n      addEventListener(\"storage\", function (e) {\n        self.emit(e.key);\n      });\n    } else { // old IE\n      window.attachEvent(\"storage\", function (e) {\n        self.emit(e.key);\n      });\n    }\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (isChromeApp()) {\n    chrome.storage.local.set({dbName: dbName});\n  } else if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    return fun.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1];\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\nfunction isCordova() {\n  return (typeof cordova !== \"undefined\" ||\n  typeof PhoneGap !== \"undefined\" ||\n  typeof phonegap !== \"undefined\");\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n// designed to opt-in to certain optimizations, such as\n// avoiding checks for \"dependentDbs\" and other things that\n// we know only apply to local databases. In general, \"remote\"\n// should be true for the http adapter, and for third-party\n// adapters with similar expensive boundaries to cross for\n// every API call, such as socket-pouch and worker-pouch.\n// Previously, this was handled via db.type() === 'http'\n// which is now deprecated.\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev() {\n  return uuidV4.v4().replace(/-/g, '').toLowerCase();\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isChromeApp, isCordova, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import Promise from 'pouchdb-promise';\nimport { blob, readAsArrayBuffer } from 'pouchdb-binary-utils';\nimport { assign, clone } from 'pouchdb-utils';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\n\n/* global fetch */\n/* global Headers */\nfunction wrappedFetch() {\n  var wrappedPromise = {};\n\n  var promise = new Promise(function (resolve, reject) {\n    wrappedPromise.resolve = resolve;\n    wrappedPromise.reject = reject;\n  });\n\n  var args = new Array(arguments.length);\n\n  for (var i = 0; i < args.length; i++) {\n    args[i] = arguments[i];\n  }\n\n  wrappedPromise.promise = promise;\n\n  Promise.resolve().then(function () {\n    return fetch.apply(null, args);\n  }).then(function (response) {\n    wrappedPromise.resolve(response);\n  }).catch(function (error) {\n    wrappedPromise.reject(error);\n  });\n\n  return wrappedPromise;\n}\n\nfunction fetchRequest(options, callback) {\n  var wrappedPromise, timer, response;\n\n  var headers = new Headers();\n\n  var fetchOptions = {\n    method: options.method,\n    credentials: 'include',\n    headers: headers\n  };\n\n  if (options.json) {\n    headers.set('Accept', 'application/json');\n    headers.set('Content-Type', options.headers['Content-Type'] ||\n      'application/json');\n  }\n\n  if (options.body &&\n      options.processData &&\n      typeof options.body !== 'string') {\n    fetchOptions.body = JSON.stringify(options.body);\n  } else if ('body' in options) {\n    fetchOptions.body = options.body;\n  } else {\n    fetchOptions.body = null;\n  }\n\n  Object.keys(options.headers).forEach(function (key) {\n    if (options.headers.hasOwnProperty(key)) {\n      headers.set(key, options.headers[key]);\n    }\n  });\n\n  wrappedPromise = wrappedFetch(options.url, fetchOptions);\n\n  if (options.timeout > 0) {\n    timer = setTimeout(function () {\n      wrappedPromise.reject(new Error('Load timeout for resource: ' +\n        options.url));\n    }, options.timeout);\n  }\n\n  wrappedPromise.promise.then(function (fetchResponse) {\n    response = {\n      statusCode: fetchResponse.status\n    };\n\n    if (options.timeout > 0) {\n      clearTimeout(timer);\n    }\n\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      return options.binary ? fetchResponse.blob() : fetchResponse.text();\n    }\n\n    return fetchResponse.json();\n  }).then(function (result) {\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      callback(null, response, result);\n    } else {\n      result.status = response.statusCode;\n      callback(result);\n    }\n  }).catch(function (error) {\n    if (!error) {\n      // this happens when the listener is canceled\n      error = new Error('canceled');\n    }\n    callback(error);\n  });\n\n  return {abort: wrappedPromise.reject};\n}\n\nfunction xhRequest(options, callback) {\n\n  var xhr, timer;\n  var timedout = false;\n\n  var abortReq = function () {\n    xhr.abort();\n    cleanUp();\n  };\n\n  var timeoutReq = function () {\n    timedout = true;\n    xhr.abort();\n    cleanUp();\n  };\n\n  var ret = {abort: abortReq};\n\n  var cleanUp = function () {\n    clearTimeout(timer);\n    ret.abort = function () {};\n    if (xhr) {\n      xhr.onprogress = undefined;\n      if (xhr.upload) {\n        xhr.upload.onprogress = undefined;\n      }\n      xhr.onreadystatechange = undefined;\n      xhr = undefined;\n    }\n  };\n\n  if (options.xhr) {\n    xhr = new options.xhr();\n  } else {\n    xhr = new XMLHttpRequest();\n  }\n\n  try {\n    xhr.open(options.method, options.url);\n  } catch (exception) {\n    return callback(new Error(exception.name || 'Url is invalid'));\n  }\n\n  xhr.withCredentials = ('withCredentials' in options) ?\n    options.withCredentials : true;\n\n  if (options.method === 'GET') {\n    delete options.headers['Content-Type'];\n  } else if (options.json) {\n    options.headers.Accept = 'application/json';\n    options.headers['Content-Type'] = options.headers['Content-Type'] ||\n      'application/json';\n    if (options.body &&\n        options.processData &&\n        typeof options.body !== \"string\") {\n      options.body = JSON.stringify(options.body);\n    }\n  }\n\n  if (options.binary) {\n    xhr.responseType = 'arraybuffer';\n  }\n\n  if (!('body' in options)) {\n    options.body = null;\n  }\n\n  for (var key in options.headers) {\n    if (options.headers.hasOwnProperty(key)) {\n      xhr.setRequestHeader(key, options.headers[key]);\n    }\n  }\n\n  if (options.timeout > 0) {\n    timer = setTimeout(timeoutReq, options.timeout);\n    xhr.onprogress = function () {\n      clearTimeout(timer);\n      if (xhr.readyState !== 4) {\n        timer = setTimeout(timeoutReq, options.timeout);\n      }\n    };\n    if (typeof xhr.upload !== 'undefined') { // does not exist in ie9\n      xhr.upload.onprogress = xhr.onprogress;\n    }\n  }\n\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    var response = {\n      statusCode: xhr.status\n    };\n\n    if (xhr.status >= 200 && xhr.status < 300) {\n      var data;\n      if (options.binary) {\n        data = blob([xhr.response || ''], {\n          type: xhr.getResponseHeader('Content-Type')\n        });\n      } else {\n        data = xhr.responseText;\n      }\n      callback(null, response, data);\n    } else {\n      var err = {};\n      if (timedout) {\n        err = new Error('ETIMEDOUT');\n        err.code = 'ETIMEDOUT';\n      } else if (typeof xhr.response === 'string' && xhr.response !== '') {\n        try {\n          err = JSON.parse(xhr.response);\n        } catch (e) {}\n      }\n\n      err.status = xhr.status;\n\n      callback(err);\n    }\n    cleanUp();\n  };\n\n  if (options.body && (options.body instanceof Blob)) {\n    readAsArrayBuffer(options.body, function (arrayBuffer) {\n      xhr.send(arrayBuffer);\n    });\n  } else {\n    xhr.send(options.body);\n  }\n\n  return ret;\n}\n\nfunction testXhr() {\n  try {\n    new XMLHttpRequest();\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n\nvar hasXhr = testXhr();\n\nfunction ajax(options, callback) {\n  if (!false && (hasXhr || options.xhr)) {\n    return xhRequest(options, callback);\n  } else {\n    return fetchRequest(options, callback);\n  }\n}\n\n// the blob already has a type; do nothing\n\nfunction defaultBody() {\n  return '';\n}\n\nfunction ajaxCore(options, callback) {\n\n  options = clone(options);\n\n  var defaultOptions = {\n    method : \"GET\",\n    headers: {},\n    json: true,\n    processData: true,\n    timeout: 10000,\n    cache: false\n  };\n\n  options = assign(defaultOptions, options);\n\n  function onSuccess(obj, resp, cb) {\n    if (!options.binary && options.json && typeof obj === 'string') {\n      /* istanbul ignore next */\n      try {\n        obj = JSON.parse(obj);\n      } catch (e) {\n        // Probably a malformed JSON from server\n        return cb(e);\n      }\n    }\n    if (Array.isArray(obj)) {\n      obj = obj.map(function (v) {\n        if (v.error || v.missing) {\n          return generateErrorFromResponse(v);\n        } else {\n          return v;\n        }\n      });\n    }\n    if (options.binary) {\n      \n    }\n    cb(null, obj, resp);\n  }\n\n  if (options.json) {\n    if (!options.binary) {\n      options.headers.Accept = 'application/json';\n    }\n    options.headers['Content-Type'] = options.headers['Content-Type'] ||\n      'application/json';\n  }\n\n  if (options.binary) {\n    options.encoding = null;\n    options.json = false;\n  }\n\n  if (!options.processData) {\n    options.json = false;\n  }\n\n  return ajax(options, function (err, response, body) {\n\n    if (err) {\n      return callback(generateErrorFromResponse(err));\n    }\n\n    var error;\n    var content_type = response.headers && response.headers['content-type'];\n    var data = body || defaultBody();\n\n    // CouchDB doesn't always return the right content-type for JSON data, so\n    // we check for ^{ and }$ (ignoring leading/trailing whitespace)\n    if (!options.binary && (options.json || !options.processData) &&\n        typeof data !== 'object' &&\n        (/json/.test(content_type) ||\n         (/^[\\s]*\\{/.test(data) && /\\}[\\s]*$/.test(data)))) {\n      try {\n        data = JSON.parse(data.toString());\n      } catch (e) {}\n    }\n\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      onSuccess(data, response, callback);\n    } else {\n      error = generateErrorFromResponse(data);\n      error.status = response.statusCode;\n      callback(error);\n    }\n  });\n}\n\nfunction ajax$1(opts, callback) {\n\n  // cache-buster, specifically designed to work around IE's aggressive caching\n  // see http://www.dashbay.com/2011/05/internet-explorer-caches-ajax/\n  // Also Safari caches POSTs, so we need to cache-bust those too.\n  var ua = (navigator && navigator.userAgent) ?\n    navigator.userAgent.toLowerCase() : '';\n\n  var isSafari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n\n  // it appears the new version of safari also caches GETs,\n  // see https://github.com/pouchdb/pouchdb/issues/5010\n  var shouldCacheBust = (isSafari ||\n    ((isIE || isTrident || isEdge) && opts.method === 'GET'));\n\n  var cache = 'cache' in opts ? opts.cache : true;\n\n  var isBlobUrl = /^blob:/.test(opts.url); // don't append nonces for blob URLs\n\n  if (!isBlobUrl && (shouldCacheBust || !cache)) {\n    var hasArgs = opts.url.indexOf('?') !== -1;\n    opts.url += (hasArgs ? '&' : '?') + '_nonce=' + Date.now();\n  }\n\n  return ajaxCore(opts, callback);\n}\n\nexport default ajax$1;\n","var thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  if (typeof FileReader === 'undefined') {\n    // fix for Firefox in a web worker\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=901097\n    return callback(arrayBufferToBinaryString(\n      new FileReaderSync().readAsArrayBuffer(blob)));\n  }\n\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  if (typeof FileReader === 'undefined') {\n    // fix for Firefox in a web worker:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=901097\n    return callback(new FileReaderSync().readAsArrayBuffer(blob));\n  }\n\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\nfunction typedBuffer() {\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBinaryString as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","import urlJoin from 'url-join';\nimport urlParse from 'url-parse';\nimport inherits from 'inherits';\nimport { btoa } from 'pouchdb-binary-utils';\nimport ajaxCore from 'pouchdb-ajax';\nimport { assign, toPromise, clone } from 'pouchdb-utils';\nimport Promise from 'pouchdb-promise';\n\nfunction getBaseUrl(db) {\n  // Parse database url\n  var url;\n  if (typeof db.getUrl === 'function') { // pouchdb pre-6.0.0\n    url = urlParse(db.getUrl());\n  } else { // pouchdb post-6.0.0\n    // Use PouchDB.defaults' prefix, if any\n    var prefix = db.__opts && db.__opts.prefix ? db.__opts.prefix + '/' : '';\n    url = urlParse(prefix + db.name);\n  }\n\n  // Compute parent path for databases not hosted on domain root (see #215)\n  var path = url.pathname;\n  path = path.substr(-1, 1) === '/' ? path.substr(0, -1) : path;\n  var parentPath = path.split('/').slice(0, -1).join('/');\n\n  return url.origin + parentPath;\n}\n\nfunction getConfigUrl(db, nodeName) {\n  return urlJoin(getBaseUrl(db), (nodeName ? '/_node/' + nodeName : '') + '/_config');\n}\n\nfunction getUsersUrl(db) {\n  return urlJoin(getBaseUrl(db), '/_users');\n}\n\nfunction getSessionUrl(db) {\n  return urlJoin(getBaseUrl(db), '/_session');\n}\n\nfunction getBasicAuthHeaders(db) {\n  var auth;\n\n  if (db.__opts.auth) {\n    auth = db.__opts.auth;\n  } else {\n    var url = urlParse(db.name);\n    if (url.auth) {\n      auth = url;\n    }\n  }\n\n  if (!auth) {\n    return {};\n  }\n\n  var str = auth.username + ':' + auth.password;\n  var token = btoa(unescape(encodeURIComponent(str)));\n  return {Authorization: 'Basic ' + token};\n}\n\nfunction wrapError(callback) {\n  // provide more helpful error message\n  return function (err, res) {\n    if (err) {\n      if (err.name === 'unknown_error') {\n        err.message = (err.message || '') +\n            ' Unknown error!  Did you remember to enable CORS?';\n      }\n    }\n    return callback(err, res);\n  };\n}\n\nfunction AuthError(message) {\n  this.status = 400;\n  this.name = 'authentication_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, AuthError);\n  } catch (e) {}\n}\n\ninherits(AuthError, Error);\n\nvar getMembership = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n\n  var url = getBaseUrl(db) + '/_membership';\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar signUpAdmin = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  db.getMembership(opts, function (error, membership) {\n    var nodeName;\n    if (error) {\n      if (error.error !== 'illegal_database_name') {\n        return callback(error);\n      } else {\n        // Some couchdb-1.x-like server\n        nodeName = undefined;\n      }\n    } else {\n      // Some couchdb-2.x-like server\n      nodeName = membership.all_nodes[0];\n    }\n\n    var configUrl = getConfigUrl(db, nodeName);\n    var url = (opts.configUrl || configUrl) + '/admins/' + encodeURIComponent(username);\n    var ajaxOpts = assign({\n      method: 'PUT',\n      url: url,\n      processData: false,\n      headers: getBasicAuthHeaders(db),\n      body: '\"' + password + '\"',\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar deleteAdmin = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getMembership(opts, function (error, membership) {\n    var nodeName;\n    if (error) {\n      if (error.error !== 'illegal_database_name') {\n        return callback(error);\n      } else {\n        // Some couchdb-1.x-like server\n        nodeName = undefined;\n      }\n    } else {\n      // Some couchdb-2.x-like server\n      nodeName = membership.all_nodes[0];\n    }\n\n    var configUrl = getConfigUrl(db, nodeName);\n    var url = (opts.configUrl || configUrl) + '/admins/' + encodeURIComponent(username);\n    var ajaxOpts = assign({\n      method: 'DELETE',\n      url: url,\n      processData: false,\n      headers: getBasicAuthHeaders(db),\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar logIn = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('this plugin only works for the http/https adapter'));\n  }\n\n  if (!username) {\n    return callback(new AuthError('you must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('you must provide a password'));\n  }\n\n  var ajaxOpts = assign({\n    method: 'POST',\n    url: getSessionUrl(db),\n    headers: assign({'Content-Type': 'application/json'}, getBasicAuthHeaders(db)),\n    body: {name: username, password: password},\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar logOut = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  var ajaxOpts = assign({\n    method: 'DELETE',\n    url: getSessionUrl(db),\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar getSession = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  var url = getSessionUrl(db);\n\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar getUsersDatabaseUrl = function () {\n  var db = this;\n  return getUsersUrl(db);\n};\n\nfunction updateUser(db, user, opts, callback) {\n  var reservedWords = [\n    '_id',\n    '_rev',\n    'name',\n    'type',\n    'roles',\n    'password',\n    'password_scheme',\n    'iterations',\n    'derived_key',\n    'salt' ];\n\n  if (opts.metadata) {\n    for (var key in opts.metadata) {\n      if (opts.metadata.hasOwnProperty(key) && reservedWords.indexOf(key) !== -1) {\n        return callback(new AuthError('cannot use reserved word in metadata: \"' + key + '\"'));\n      }\n    }\n    user = assign(user, opts.metadata);\n  }\n\n  if (opts.roles) {\n    user = assign(user, {roles: opts.roles});\n  }\n\n  var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n  var ajaxOpts = assign({\n    method: 'PUT',\n    url: url,\n    body: user,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n}\n\nvar signUp = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  var userId = 'org.couchdb.user:' + username;\n  var user = {\n    name: username,\n    password: password,\n    roles: [],\n    type: 'user',\n    _id: userId,\n  };\n\n  updateUser(db, user, opts, callback);\n});\n\nvar getUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (!username) {\n    return callback(new AuthError('you must provide a username'));\n  }\n\n  var url = getUsersUrl(db);\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url + '/' + encodeURIComponent('org.couchdb.user:' + username),\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar putUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    updateUser(db, user, opts, callback);\n  });\n});\n\nvar deleteUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id) + '?rev=' + user._rev;\n    var ajaxOpts = assign({\n      method: 'DELETE',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar changePassword = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    user.password = password;\n\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n    var ajaxOpts = assign({\n      method: 'PUT',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n      body: user,\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar changeUsername = toPromise(function (oldUsername, newUsername, opts, callback) {\n  var db = this;\n  var USERNAME_PREFIX = 'org.couchdb.user:';\n  var ajax = function (opts) {\n    return new Promise(function (resolve, reject) {\n      ajaxCore(opts, wrapError(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      }));\n    });\n  };\n  var updateUser = function (user, opts) {\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n    var updateOpts = assign({\n      method: 'PUT',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n      body: user,\n    }, opts.ajax);\n    return ajax(updateOpts);\n  };\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  opts.ajax = opts.ajax || {};\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  }\n  if (!newUsername) {\n    return callback(new AuthError('You must provide a new username'));\n  }\n  if (!oldUsername) {\n    return callback(new AuthError('You must provide a username to rename'));\n  }\n\n  db.getUser(newUsername, opts)\n  .then(function () {\n    var error = new AuthError('user already exists');\n    error.taken = true;\n    throw error;\n  }, function () {\n    return db.getUser(oldUsername, opts);\n  })\n  .then(function (user) {\n    var newUser = clone(user);\n    delete newUser._rev;\n    newUser._id = USERNAME_PREFIX + newUsername;\n    newUser.name = newUsername;\n    newUser.roles = opts.roles || user.roles || {};\n    return updateUser(newUser, opts).then(function () {\n      user._deleted = true;\n      return updateUser(user, opts);\n    });\n  }).then(function (res) {\n    callback(null, res);\n  }).catch(callback);\n});\n\nvar plugin = {};\n\nplugin.login = logIn;\nplugin.logIn = logIn;\nplugin.logout = logOut;\nplugin.logOut = logOut;\nplugin.getSession = getSession;\n\nplugin.getMembership = getMembership;\nplugin.signUpAdmin = signUpAdmin;\nplugin.deleteAdmin = deleteAdmin;\n\nplugin.getUsersDatabaseUrl = getUsersDatabaseUrl;\nplugin.signup = signUp;\nplugin.signUp = signUp;\nplugin.getUser = getUser;\nplugin.putUser = putUser;\nplugin.deleteUser = deleteUser;\nplugin.changePassword = changePassword;\nplugin.changeUsername = changeUsername;\n\nif (typeof window !== 'undefined' && window.PouchDB) {\n  window.PouchDB.plugin(plugin);\n}\n\nexport default plugin;\n","import { Injectable } from '@angular/core';\n\n// TODO\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LoggingService {\n\n  constructor() { }\n\n  error(err: string) {\n    console.error(JSON.stringify(err));\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport PouchDB from 'pouchdb';\nimport PouchAuth from 'pouchdb-authentication';\nimport { Database, DBList, Doc, ExistingDoc } from '../../models/domain.model';\nimport { AuthService } from '../auth/auth.service';\nimport { EnvironmentService } from '../env/environment.service';\nimport { LoggingService } from '../logging.service';\nimport { BulkAddResponse } from '../../models/db/response.model';\nimport { from } from 'rxjs';\n\nPouchDB.plugin(PouchAuth);\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class PouchDBService {\n  private databases: DBList = {};\n\n  constructor(\n    private environment: EnvironmentService,\n    private logger: LoggingService,\n    private authService: AuthService,\n  ) {\n    Object.values(Database).forEach((dbName) => {\n      this.databases[dbName] = { name: dbName, listener: new EventEmitter() };\n    });\n  }\n\n  public instance(dbName: Database): PouchDB.Database<{}> | undefined {\n    if (this.getDBInstance(dbName)) return this.getDBInstance(dbName);\n    return (this.databases[dbName].instance = new PouchDB(this.databases[dbName].name));\n  }\n\n  private getDBInstance(dbName: Database): PouchDB.Database<{}> | undefined {\n    return this.databases[dbName]?.instance;\n  }\n\n  getRemoteDBInstance(dbName: Database): PouchDB.Database<{}> | undefined {\n    return this.databases[dbName]?.remoteInstance;\n  }\n\n  getChangeListener(dbName: Database): EventEmitter<any> | undefined {\n    return this.databases[dbName]?.listener || undefined;\n  }\n\n  async get(dbName: Database, id: string): Promise<any | undefined> {\n    try {\n      return await this.getDBInstance(dbName)?.get(id);\n    } catch (error) {\n      return this.getRemoteDBInstance(dbName)?.get(id);\n    }\n  }\n\n  /**\n   * Unlike other create/update actions, bulk updates are tried first on the remote if available\n   * for fail fast response directly from the SSOT.\n   * TODO reverse this behavior for cases with very large payloads\n  */\n  async addAll(dbName: Database, docs: Doc[]): Promise<BulkAddResponse | undefined> {\n    const remoteDB = this.getRemoteDBInstance(dbName);\n    const localDB = this.instance(dbName);\n\n    if (!remoteDB) return localDB?.bulkDocs(docs);\n\n    try {\n      await remoteDB?.info(); // throws error with status: 404 if not available\n    } catch (error) {\n      return localDB?.bulkDocs(docs);\n    }\n\n    return remoteDB?.bulkDocs(docs);\n  }\n\n  async getAll(dbName: Database): Promise<any | undefined> {\n    const remoteDB = this.getRemoteDBInstance(dbName);\n    const localDB = this.instance(dbName);\n\n    if (localDB) return localDB.allDocs();\n\n    return remoteDB?.allDocs();\n  }\n\n  /**\n   * Use only when the id of the doc is not relevant for its access patterns/queries\n  */\n  async createUsingPost(dbName: Database, doc: Doc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      return await dbInstance?.post(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  /**\n   * Use this in most cases for creating a doc and make sure to assign a unique _id field yourself.\n  */\n  async create(dbName: Database, doc: ExistingDoc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      return await dbInstance?.put(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  /**\n   * Use when updating a doc whose current revision string is not known yet or is likely to have changed.\n  */\n  async update(dbName: Database, doc: ExistingDoc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      const result = await this.get(dbName, doc._id);\n      doc._rev = result._rev;\n      return dbInstance?.put(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  async delete(dbName: Database, doc: ExistingDoc): Promise<any> {\n    try {\n      const result = await this.get(dbName, doc._id);\n      doc._rev = result._rev;\n      doc._deleted = true;\n      return this.update(dbName, doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  remoteLogin(dbName: Database): PouchDB.Database<{}> | undefined {\n    if (this.getRemoteDBInstance(dbName)) return this.getRemoteDBInstance(dbName);\n\n    const remoteDB = new PouchDB(`${this.environment.dbUri}/${dbName}`, {\n      skip_setup: true,\n    });\n\n    if (!this?.authService?.isAuthenticated) return this.getRemoteDBInstance(dbName);\n\n    from(remoteDB.logIn(this.authService?.user, this.authService?.pass)).subscribe(_ => {\n      this.databases[dbName].remoteInstance = remoteDB;\n    });\n\n    return this.getRemoteDBInstance(dbName);\n  }\n\n  remoteSync(dbName: Database): EventEmitter<any> | undefined {\n    if (this.getRemoteDBInstance(dbName)) return this.getChangeListener(dbName);\n\n    const dbMeta = this.databases[dbName];\n    const remoteDB = new PouchDB(`${this.environment.dbUri}/${dbName}`, {\n      skip_setup: true,\n    });\n\n    if (!this.authService.isAuthenticated) return this.getChangeListener(dbName);\n\n    const localDB = dbMeta.instance ? dbMeta.instance : this.instance(dbName);\n\n    const emitOnChange = (change: any) => dbMeta?.listener?.emit(change);\n\n    from(remoteDB.logIn(this.authService?.user, this.authService?.pass))\n        .subscribe(_ => {\n\n          this.databases[dbName].remoteInstance = remoteDB;\n\n          localDB?.sync(remoteDB, { live: true })\n            .on('change', emitOnChange)\n            .on('complete', emitOnChange)\n            .on('error', (err: any) => this.logger.error(err));\n\n          this.databases[dbName].listener = dbMeta.listener;\n        });\n\n    return dbMeta.listener;\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { Database, ExistingDoc, Doc } from '../../models/domain.model';\nimport { DBService } from './db.service.interface';\nimport { PouchDBService } from './pouchdb.service';\nimport { AllDocs } from '../../models/db/all-docs.model';\nimport { BulkAddResponse } from '../../models/db/response.model';\nimport { RETTupleRev } from '../../models/db/table-headers.model';\nimport { PSchema } from '../../models/db/schema/pschema.model';\n\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ReturneeService implements DBService {\n\n  private returneeDB = Database.returnees;\n\n  private returneeHeaders_: string[][];\n\n  constructor(private dbService: PouchDBService) {\n    this.instance();\n    this.remoteSync();\n  }\n\n  instance(): PouchDB.Database<{}> | undefined {\n    return this.dbService.instance(this.returneeDB);\n  }\n\n  get headers(): string[][] { return this.returneeHeaders_; }\n\n  async getAll(startkey = 'province:', endkey = 'province:\\ufff0'): Promise<AllDocs.Root | undefined> {\n    const requestQuery = {\n      include_docs: true,\n      startkey,\n      endkey,\n      limit: 800,\n    };\n    const locAllDocs = await this.instance()?.allDocs(requestQuery) as AllDocs.Root;\n\n    if (locAllDocs?.rows?.length !== 0) return locAllDocs;\n\n    return await this.dbService?.getRemoteDBInstance(this.returneeDB)?.allDocs(requestQuery) as AllDocs.Root;\n  }\n\n  async addAll(docs: Doc[]): Promise<BulkAddResponse | undefined> {\n    return this.dbService.addAll(this.returneeDB, docs);\n  }\n\n  async getAllWards(): Promise<Array<RETTupleRev> | undefined> {\n    try {\n      const response = await this.getAll();\n      return response?.rows?.map(row => [...row?.doc?.fields, row?.doc?._rev] as unknown as RETTupleRev);\n    } catch (error) {\n      throw Error('Ward-wise Returnee data could not be fetched');\n    }\n  }\n\n  async getTableHeaders(current = 'pschema:returnees:v8'): Promise<string[][]> {\n    // TODO put data from pschema:pcrs:v8.ts if not found on the remote db\n    if (this.returneeHeaders_) return Promise.resolve(this.returneeHeaders_);\n    try {\n      const response = await this.get(current) as PSchema;\n      return (this.returneeHeaders_ = response.fields);\n    } catch (error) {\n      throw Error('Returnee data table headers could not be fetched');\n    }\n  }\n\n\n  remoteSync(): EventEmitter<any> | undefined {\n    return this.dbService?.remoteSync(this.returneeDB);\n  }\n\n  getChangeListener(): EventEmitter<any> | undefined {\n    return this.dbService?.getChangeListener(this.returneeDB);\n  }\n\n  get(id: string): Promise<any> | undefined {\n    return this.dbService.get(this.returneeDB, id);\n  }\n\n  create(doc: ExistingDoc): Promise<any> {\n    return this.dbService.create(this.returneeDB, doc);\n  }\n\n  update(doc: ExistingDoc): Promise<any> {\n    return this.dbService.update(this.returneeDB, doc);\n  }\n\n  delete(doc: ExistingDoc): Promise<any> {\n    return this.dbService.delete(this.returneeDB, doc);\n  }\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  return decodeURIComponent(input.replace(/\\+/g, ' '));\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  //\n  // Little nifty parsing hack, leverage the fact that RegExp.exec increments\n  // the lastIndex property so we can continue executing this loop until we've\n  // parsed all results.\n  //\n  for (;\n    part = parser.exec(query);\n    result[decode(part[1])] = decode(part[2])\n  );\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = [];\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\n\nexports.test = function () {\n  if (global.setImmediate) {\n    // we can only get here in IE10\n    // which doesn't handel postMessage well\n    return false;\n  }\n  return typeof global.MessageChannel !== 'undefined';\n};\n\nexports.install = function (func) {\n  var channel = new global.MessageChannel();\n  channel.port1.onmessage = func;\n  return function () {\n    channel.port2.postMessage(0);\n  };\n};","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n"]}