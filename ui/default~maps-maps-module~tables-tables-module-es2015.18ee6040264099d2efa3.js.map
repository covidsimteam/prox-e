{"version":3,"sources":["webpack:///node_modules/pouchdb-utils/node_modules/uuid/lib/rng-browser.js","webpack:///node_modules/events/events.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/lib/bytesToUuid.js","webpack:///node_modules/argsarray/index.js","webpack:///node_modules/immediate/lib/timeout.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/index.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/v4.js","webpack:///node_modules/immediate/lib/mutation.js","webpack:///node_modules/lie/node_modules/immediate/lib/browser.js","webpack:///node_modules/url-parse/index.js","webpack:///node_modules/lie/lib/browser.js","webpack:///node_modules/inherits/inherits_browser.js","webpack:///node_modules/requires-port/index.js","webpack:///node_modules/url-join/lib/url-join.js","webpack:///node_modules/immediate/lib/queueMicrotask.js","webpack:///node_modules/spark-md5/spark-md5.js","webpack:///node_modules/vuvuzela/index.js","webpack:///node_modules/immediate/lib/index.js","webpack:///node_modules/pouchdb-authentication/node_modules/inherits/inherits_browser.js","webpack:///node_modules/immediate/lib/stateChange.js","webpack:///node_modules/pouchdb-utils/node_modules/uuid/v1.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/rng.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/bytesToUuid.js","webpack:///node_modules/pouchdb/lib/index-browser.es.js","webpack:///node_modules/pouchdb/node_modules/uuid/dist/esm-browser/v4.js","webpack:///node_modules/pouchdb-promise/lib/index.es.js","webpack:///node_modules/pouchdb-collections/lib/index.es.js","webpack:///node_modules/pouchdb-errors/lib/index.es.js","webpack:///node_modules/pouchdb-utils/lib/index-browser.es.js","webpack:///node_modules/pouchdb-ajax/lib/index-browser.es.js","webpack:///node_modules/pouchdb-binary-utils/lib/index-browser.es.js","webpack:///node_modules/pouchdb-authentication/lib/index.es.js","webpack:///src/app/services/logging.service.ts","webpack:///src/app/services/db/pouchdb.service.ts","webpack:///src/app/services/db/returnee.service.ts","webpack:///node_modules/querystringify/index.js","webpack:///node_modules/pouchdb-utils/node_modules/immediate/lib/browser.js","webpack:///node_modules/pouchdb-errors/node_modules/inherits/inherits_browser.js","webpack:///node_modules/immediate/lib/messageChannel.js","webpack:///node_modules/pouchdb-utils/node_modules/inherits/inherits_browser.js"],"names":["getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","module","exports","rnds","Array","r","i","Math","random","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","prototype","call","ownKeys","Object","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","value","EventEmitter","init","this","once","emitter","name","Promise","resolve","reject","eventListener","undefined","errorListener","removeListener","slice","arguments","err","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","create","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","arrayClone","listenerCount","n","copy","defineProperty","enumerable","get","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","handler","len","listeners","on","addListener","prependListener","prependOnceListener","off","list","position","originalListener","shift","index","pop","removeAllListeners","key","keys","rawListeners","eventNames","byteToHex","toString","substr","buf","offset","fun","test","install","t","setTimeout","v1","v4","uuid","rng","bytesToUuid","options","ii","Mutation","global","MutationObserver","WebKitMutationObserver","handle","called","observer","element","document","createTextNode","observe","characterData","data","scheduleDrain","draining","nextTick","setImmediate","MessageChannel","createElement","scriptEl","onreadystatechange","parentNode","removeChild","documentElement","appendChild","channel","port1","onmessage","port2","postMessage","queue","oldQueue","task","required","qs","protocolre","slashes","rules","NaN","ignore","hash","query","lolcation","loc","finaldestination","location","protocol","URL","unescape","pathname","href","extractProtocol","address","match","exec","toLowerCase","rest","parser","relative","extracted","parse","instruction","instructions","url","indexOf","charAt","base","path","split","last","up","splice","join","port","host","hostname","username","password","auth","origin","part","fn","char","ins","stringify","result","immediate","INTERNAL","handlers","REJECTED","FULFILLED","PENDING","resolver","outcome","safelyResolveThenable","QueueItem","promise","onFulfilled","onRejected","callFulfilled","otherCallFulfilled","callRejected","otherCallRejected","func","returnValue","e","getThen","obj","then","self","thenable","onError","onSuccess","tryCatch","status","out","constructor","reason","all","iterable","values","resolved","allResolver","outValue","race","response","ctor","superCtor","super_","writable","configurable","TempCtor","normalize","strArray","resultArray","first","replace","component","str","parts","definition","queueMicrotask","hex_chr","md5cycle","x","k","a","b","c","d","md5blk","s","md5blks","charCodeAt","md5blk_array","md51","tail","tmp","lo","hi","substring","parseInt","rhex","j","hex","toUtf8","encodeURIComponent","hexToBinaryString","bytes","fromCharCode","SparkMD5","reset","ArrayBuffer","clamp","val","max","min","from","to","num","targetArray","sourceArray","byteLength","begin","end","factory","append","appendBinary","contents","_buff","_length","_hash","raw","buff","_finish","getState","setState","destroy","hashBinary","content","second","buffer","subarray","returnUInt8Array","stack","metaStack","lastMetaElement","lastElementIndex","isArray","input","next","objPrefix","res","prefix","JSON","hasOwnProperty","collationIndex","parsedNum","numChar","parsedString","lastCh","numConsecutiveSlashes","ch","arrayElement","objElement","parseFloat","currentQueue","types","queueIndex","scheduled","cleanUpNextTick","timeout","run","clearTimeout","Item","array","_nodeId","_clockseq","_lastMSecs","_lastNSecs","node","clockseq","seedBytes","msecs","Date","getTime","nsecs","dt","tl","tmh","ExportedSet","ExportedMap","start","mangle","unmangle","Map$1","_store","Set$1","add","mangled","has","delete","forEach","cb","size","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","hasLocal","funcToString","objectCtorString","clone","object","newObject","toISOString","Blob","webkitSlice","proto","Ctor","toPromise","usedCB","fulfill","resp","callback","mesg","adapterFun","_closed","_destroyed","logArgs","origCallback","responseArgs","taskqueue","isReady","addTask","failed","pick","identityFunction","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","allRequests","nextBatch","upTo","batch","docId","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","results","info","localStorage","setItem","getItem","hasLocalStorage","Changes","addEventListener","guardedConsole","method","defaultBackOff","maxTimeout","explainError","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","$inject_Object_assign","assign","nextSource","nextKey","PouchError","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","UNKNOWN_ERROR","BAD_ARG","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","IDB_ERROR","INVALID_REV","MISSING_STUB","createError","CustomPouchError","names","generateErrorFromResponse","filterChange","req","hasFilter","query_params","change","doc","filterReturn","msg","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","parseDesignDocFunctionName","normalizeDesignDocFunctionName","normalized","qParser","parseUri","uri","encoded","decodeURIComponent","$0","$1","$2","scopeEval","source","scope","upsert","diffFun","docRev","_rev","newDoc","updated","_id","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","getBlob","binaryStringToArrayBuffer","bin","binStringToBluffer","binString","b64ToBluffer","b64","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","binary","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","appendBlob","arrayBuffer","appendString","string","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","loadNextChunk","done","stringMd5","deterministic_revs","clonedDoc","_rev_tree","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","rootToLeaf","paths","history","sortByPos$1","insertSorted","item","comparator","idx","mid","low","high","pathToTree","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","candidateParents","trees","diff","parent","parentIdx","elements","elementsLen","el","merge","depth","newTree","stemmed","stemmedRevs","revHash","getTrees","isDeleted","isLocalId","Changes$1","complete","ee","onDestroy","cancel","pending","lastSeq","isCancelled","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","compareByIdThenRev","idCompare","_revisions","AbstractPouchDB","p","TaskQueue","__opts","auto_compaction","backend","adapter","adapters","preferredAdapters","adapterName","use_prefix","_adapter","valid","fail","onDestroyed","from_constructor","onClosed","ready","_changesFilterPlugin","validate","doChanges","continuous","live","shouldFilter","descending","limit","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_deleted","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","putAttachment","attachmentId","rev$$1","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","_getRevisionTree","missingForId","missingObj","compactDocument","maxHeight","revTree","height","edges","prnt","edge","candidates","_doCompaction","compact","_compactionQueue","doNextCompaction","catch","last_seq","_compact","promises","return_docs","row","_getLocal","finishOpenRevs","latest","l","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","_revs_info","_getAttachment","getAttachment","allDocs","skip","start_key","startkey","end_key","endkey","incompatibleOpt","_allDocs","close","_close","_info","db_name","_type","attachmentError","atts","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","usePrefix","destroyDb","_destroy","localDoc","PouchDB","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","getFieldFromDoc","parsedField","parseField","fieldName","fields","current","Pouch","destructListeners","_destructionListeners","dbList","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","combinationFields","isCombinationalField","field","getKey","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","$gte","$gt","$lte","$lt","$ne","massageSelector","wasAnded","isAndInSelector","isAnd","mergeAndedSelectorsNested","orOrNor","subSelector","collate","normalizeKey","ai","bi","ak","bk","Infinity","origKey","toJSON","toIndexableString","expFormat","toExponential","magnitude","neg","padWith","upToLength","padding","targetLength","factor","abs","factorStr","toFixed","objKey","parseNumber","originalIdx","numAsString","magAsString","rowFilter","inMemoryFields","every","docFieldValue","some","orMatchers","find","matchSelector","userOperator","userValue","matchers","fieldExists","fieldIsNotUndefined","arrayContainsValue","divisor","mod","neValue","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","rowsMatched","rows","requestDef","fieldSorter","getFieldValuesAsArray","sorting","aRow","bRow","collation","filterName","filterFun","filters","toObject","reduce","version","dataWords","parseRevisionInfo","parseDoc","newEdits","dbOpts","nRevNum","revInfo","revisions","revisionIds","specialKey","preprocessAttachment","blobType","asBinary","digest","md5","DOC_STORE","META_STORE","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","checkDone","attObj","objectStore","onsuccess","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","IDBKeyRange","bound","openCursor","only","event","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","mode","transaction","runBatchedCursor","keyRange","batchSize","onBatch","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","newKeyRange","lastKey","upper","upperOpen","code","lowerBound","running","applyNext","blobSupportPromise","cachedDBs","openReqList","IdbPouch","action","addDeletedOrLocalIndex","docStore","createIndex","unique","migrateLocalStore","localStore","local","docIdRev","range","seqCursor","migrateAttsAndSeqs","digestMap","digests","migrateMetadata","bySeqStore","onGetMetadataSeq","metadataSeq","metadataToStore","_meta","instanceId","reqOpts","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","docInfos","allDocsProcessed","docCountDelta","fetchedDocs","preconditionErrored","onAllDocsProcessed","updateDocCountIfReady","docCount","writeDoc","docInfo","winningRev$$1","winningRevIsDeleted","newRevIsDeleted","isUpdate","delta","resultsIdx","collectResults","finishDoc","attachmentSaved","afterPutDoc","revsToDelete","afterPutMetadata","attsAdded","attsToAdd","onerror","preventDefault","stopPropagation","putReq","overallErr","docv","recv","processedAttachment","blobSupport","txnResult","onabort","ontimeout","oncomplete","finish","filename","attErr","verifyAttachments","numFetched","readMetadata","revLimit","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","prev","splitRev","targetPos","targetId","previousWinningRev","previouslyDeleted","isRoot","newRev","rev_map","revs_limit","historyNode","attachId","attachment","blobData","updateSeq","doc_count","idb_attachment_format","keyRangeError","inclusiveEnd","upperBound","inclusive_end","onResultsReady","docIdRevIndex","allDocsInner","processBatch","batchValues","batchValue","batchKeys","returnVal","total_rows","maxKey","docIds","numResults","docIdsToMetadata","onGetMetadata","objectStores","winningDocs","metadatas","winningDoc","processMetadataAndWinningDoc","filtered","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createObjectStore","keyPath","autoIncrement","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","supportsBulkGetMap","encodeDocId","preprocessAttachments$1","genDBUrl","genUrl","paramsToStr","params","HttpPouch","user","dbUrl","setupPromise","ourFetch","headers","credentials","nAuth","token","ua","isIE","isTrident","isEdge","now","adapterFun$$1","setup","fetchJSON","v","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","promiseFactories","filenames","typeFieldDescriptor","__proto__","doNext","runNextBatch","thisErr","docOrDocs","contentType","process","browser","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","lastFetchedSeq","controller","fetchData","aborted","fetchOpts","signal","fetched","raw_results_length","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createView","sourceDB","reduceFun","temporary","localDocName","cachedViews","viewSignature","_cachedViews","promiseForView","depDbName","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","parseViewName","emitError","builtInReduce","sumsqr","_sumsqr","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","checkQueryParseError","startkeyName","endkeyName","group","group_level","optionName","number","defaultsTo","getQueue","updateView","mapResults","origMap","currentSeq","processNextBatch","docIdsToChangesAndEmits","indexableKeysToKeyValues","createIndexableKeysToKeyValues","metaDocId","defaultMetaDoc","docData","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","listOfDocsToPersist","docsToPersist","emittedKeyValue","complexKey","queryView","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","parsedStr","onMapResultsReady","finalResults","shouldGroup","reduceFunString","groups","lvl","POSITIVE_INFINITY","groupKey","reduceTry","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","_query","keysAsString","finalPromiseFactory","stale","viewCleanup","_viewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","destroyPromises","mapreduce","isGenOne$1","getDocAttachments","updateCheckpoint","checkpoint","session","session_id","replicator","Checkpointer","src","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","sessionId","props","floor","replicate","currentBatch","checkpointer","batches","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","queryParams","filterViewName","queryData","md5sum","writeDocs","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getBatchDocs","diffs","resultDocs","bulkGetOpts","missingRev","bulkGetResponse","bulkGetInfo","remoteDoc","doCheckForLocalAttachments","Boolean","got","startNextBatch","abortReplication","processPendingBatch","immediate$$1","fatalError","end_time","retry","back_off_function","backOffSet","current_back_off","onChangesComplete","onChangesError","_abortChanges","abortChanges","startChanges","getCheckpoint","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","direction","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","success","_readyCalled","replicateMethods","other","isChromeApp","chrome","storage","onChanged","newValue","window","attachEvent","assign$1","hasXhr","XMLHttpRequest","ajaxCore","processData","cache","Accept","encoding","xhr","timer","timedout","timeoutReq","cleanUp","onprogress","upload","exception","withCredentials","responseType","setRequestHeader","readyState","statusCode","getResponseHeader","responseText","FileReaderSync","send","wrappedPromise","fetchOptions","fetchResponse","text","isSafari","shouldCacheBust","hasArgs","getBaseUrl","getUrl","parentPath","getConfigUrl","nodeName","getUsersUrl","getSessionUrl","getBasicAuthHeaders","Authorization","wrapError","AuthError","getMembership","ajaxOpts","ajax","signUpAdmin","membership","all_nodes","configUrl","deleteAdmin","logIn","logOut","getSession","reservedWords","roles","signUp","getUser","putUser","deleteUser","changePassword","changeUsername","oldUsername","newUsername","updateUser","taken","newUser","login","logout","getUsersDatabaseUrl","signup","LoggingService","PouchDBService","environment","logger","authService","databases","getDBInstance","instance","remoteInstance","getRemoteDBInstance","remoteDB","localDB","dbInstance","_","update","dbUri","isAuthenticated","pass","subscribe","getChangeListener","dbMeta","emitOnChange","ReturneeService","dbService","returneeDB","returnees","remoteSync","returneeHeaders_","requestQuery","locAllDocs","addAll","decode","pairs"],"mappings":"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","file":"x","sourcesContent":["// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function eventListener() {\n      if (errorListener !== undefined) {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n    var errorListener;\n\n    // Adding an error listener is not optional because\n    // if an error is thrown on an event emitter we cannot\n    // guarantee that the actual event we are waiting will\n    // be fired. The result could be a silent way to create\n    // memory or file descriptor leaks, which is something\n    // we should avoid.\n    if (name !== 'error') {\n      errorListener = function errorListener(err) {\n        emitter.removeListener(name, eventListener);\n        reject(err);\n      };\n\n      emitter.once('error', errorListener);\n    }\n\n    emitter.once(name, eventListener);\n  });\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nexports.test = function () {\n  return true;\n};\n\nexports.install = function (t) {\n  return function () {\n    setTimeout(t, 0);\n  };\n};","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","'use strict';\n//based off rsvp https://github.com/tildeio/rsvp.js\n//license https://github.com/tildeio/rsvp.js/blob/master/LICENSE\n//https://github.com/tildeio/rsvp.js/blob/master/lib/rsvp/asap.js\n\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nexports.test = function () {\n  return Mutation;\n};\n\nexports.install = function (handle) {\n  var called = 0;\n  var observer = new Mutation(handle);\n  var element = global.document.createTextNode('');\n  observer.observe(element, {\n    characterData: true\n  });\n  return function () {\n    element.data = (called = ++called % 2);\n  };\n};","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","'use strict';\n\nvar required = require('requires-port')\n  , qs = require('querystringify')\n  , protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i\n  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @api public\n */\nfunction lolcation(loc) {\n  loc = loc || global.location || {};\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new URL(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new URL(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) continue;\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @return {ProtocolExtract} Extracted information.\n * @api private\n */\nfunction extractProtocol(address) {\n  var match = protocolre.exec(address);\n\n  return {\n    protocol: match[1] ? match[1].toLowerCase() : '',\n    slashes: !!match[2],\n    rest: match[3]\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @api private\n */\nfunction resolve(relative, base) {\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) unshift = true;\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) path.unshift('');\n  if (last === '.' || last === '..') path.push('');\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} location Location defaults for relative paths.\n * @param {Boolean|Function} parser Parser for the query string.\n * @api public\n */\nfunction URL(address, location, parser) {\n  if (!(this instanceof URL)) {\n    return new URL(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) parser = qs.parse;\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '');\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (!extracted.slashes) instructions[2] = [/(.*)/, 'pathname'];\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) url[key] = url[key].toLowerCase();\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL}\n * @api public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || qs.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!required(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) value += ':'+ url.port;\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    default:\n      url[part] = value;\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String}\n * @api public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';\n\n  var result = protocol + (url.slashes ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  }\n\n  result += url.host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n}\n\nURL.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nURL.extractProtocol = extractProtocol;\nURL.location = lolcation;\nURL.qs = qs;\n\nmodule.exports = URL;\n","'use strict';\nvar immediate = require('immediate');\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n","(function (name, context, definition) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = definition();\n  else if (typeof define === 'function' && define.amd) define(definition);\n  else context[name] = definition();\n})('urljoin', this, function () {\n\n  function normalize (strArray) {\n    var resultArray = [];\n\n    // If the first part is a plain protocol, we combine it with the next part.\n    if (strArray[0].match(/^[^/:]+:\\/*$/) && strArray.length > 1) {\n      var first = strArray.shift();\n      strArray[0] = first + strArray[0];\n    }\n\n    // There must be two or three slashes in the file protocol, two slashes in anything else.\n    if (strArray[0].match(/^file:\\/\\/\\//)) {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1:///');\n    } else {\n      strArray[0] = strArray[0].replace(/^([^/:]+):\\/*/, '$1://');\n    }\n\n    for (var i = 0; i < strArray.length; i++) {\n      var component = strArray[i];\n\n      if (typeof component !== 'string') {\n        throw new TypeError('Url must be a string. Received ' + component);\n      }\n\n      if (component === '') { continue; }\n\n      if (i > 0) {\n        // Removing the starting slashes for each component but the first.\n        component = component.replace(/^[\\/]+/, '');\n      }\n      if (i < strArray.length - 1) {\n        // Removing the ending slashes for each component but the last.\n        component = component.replace(/[\\/]+$/, '');\n      } else {\n        // For the last component we will combine multiple slashes to a single one.\n        component = component.replace(/[\\/]+$/, '/');\n      }\n\n      resultArray.push(component);\n\n    }\n\n    var str = resultArray.join('/');\n    // Each input component is now separated by a single slash except the possible first plain protocol part.\n\n    // remove trailing slash before parameters or hash\n    str = str.replace(/\\/(\\?|&|#[^!])/g, '$1');\n\n    // replace ? in parameters with &\n    var parts = str.split('?');\n    str = parts.shift() + (parts.length > 0 ? '?': '') + parts.join('&');\n\n    return str;\n  }\n\n  return function () {\n    var input;\n\n    if (typeof arguments[0] === 'object') {\n      input = arguments[0];\n    } else {\n      input = [].slice.call(arguments);\n    }\n\n    return normalize(input);\n  };\n\n});\n","'use strict';\nexports.test = function () {\n  return typeof global.queueMicrotask === 'function';\n};\n\nexports.install = function (func) {\n  return function () {\n    global.queueMicrotask(func);\n  };\n};\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash.slice()\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} [raw] True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} [raw]     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     [raw] True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","'use strict';\nvar types = [\n  require('./nextTick'),\n  require('./queueMicrotask'),\n  require('./mutation.js'),\n  require('./messageChannel'),\n  require('./stateChange'),\n  require('./timeout')\n];\nvar draining;\nvar currentQueue;\nvar queueIndex = -1;\nvar queue = [];\nvar scheduled = false;\nfunction cleanUpNextTick() {\n  if (!draining || !currentQueue) {\n    return;\n  }\n  draining = false;\n  if (currentQueue.length) {\n    queue = currentQueue.concat(queue);\n  } else {\n    queueIndex = -1;\n  }\n  if (queue.length) {\n    nextTick();\n  }\n}\n\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  if (draining) {\n    return;\n  }\n  scheduled = false;\n  draining = true;\n  var len = queue.length;\n  var timeout = setTimeout(cleanUpNextTick);\n  while (len) {\n    currentQueue = queue;\n    queue = [];\n    while (currentQueue && ++queueIndex < len) {\n      currentQueue[queueIndex].run();\n    }\n    queueIndex = -1;\n    len = queue.length;\n  }\n  currentQueue = null;\n  queueIndex = -1;\n  draining = false;\n  clearTimeout(timeout);\n}\nvar scheduleDrain;\nvar i = -1;\nvar len = types.length;\nwhile (++i < len) {\n  if (types[i] && types[i].test && types[i].test()) {\n    scheduleDrain = types[i].install(nextTick);\n    break;\n  }\n}\n// v8 likes predictible objects\nfunction Item(fun, array) {\n  this.fun = fun;\n  this.array = array;\n}\nItem.prototype.run = function () {\n  var fun = this.fun;\n  var array = this.array;\n  switch (array.length) {\n  case 0:\n    return fun();\n  case 1:\n    return fun(array[0]);\n  case 2:\n    return fun(array[0], array[1]);\n  case 3:\n    return fun(array[0], array[1], array[2]);\n  default:\n    return fun.apply(null, array);\n  }\n\n};\nmodule.exports = immediate;\nfunction immediate(task) {\n  var args = new Array(arguments.length - 1);\n  if (arguments.length > 1) {\n    for (var i = 1; i < arguments.length; i++) {\n      args[i - 1] = arguments[i];\n    }\n  }\n  queue.push(new Item(task, args));\n  if (!scheduled && !draining) {\n    scheduled = true;\n    scheduleDrain();\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\n\nexports.test = function () {\n  return 'document' in global && 'onreadystatechange' in global.document.createElement('script');\n};\n\nexports.install = function (handle) {\n  return function () {\n\n    // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n    // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n    var scriptEl = global.document.createElement('script');\n    scriptEl.onreadystatechange = function () {\n      handle();\n\n      scriptEl.onreadystatechange = null;\n      scriptEl.parentNode.removeChild(scriptEl);\n      scriptEl = null;\n    };\n    global.document.documentElement.appendChild(scriptEl);\n\n    return handle;\n  };\n};","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n// find the complete implementation of crypto (msCrypto) on IE11.\nvar getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  if (!getRandomValues) {\n    throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n  }\n\n  return getRandomValues(rnds8);\n}","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  return (bth[buf[i + 0]] + bth[buf[i + 1]] + bth[buf[i + 2]] + bth[buf[i + 3]] + '-' + bth[buf[i + 4]] + bth[buf[i + 5]] + '-' + bth[buf[i + 6]] + bth[buf[i + 7]] + '-' + bth[buf[i + 8]] + bth[buf[i + 9]] + '-' + bth[buf[i + 10]] + bth[buf[i + 11]] + bth[buf[i + 12]] + bth[buf[i + 13]] + bth[buf[i + 14]] + bth[buf[i + 15]]).toLowerCase();\n}\n\nexport default bytesToUuid;","import immediate from 'immediate';\nimport { v4 } from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport EE from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EE);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EE.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EE.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    var names = Object.getOwnPropertyNames(error);\n    for (var i = 0, len = names.length; i < len; i++) {\n      if (typeof error[names[i]] !== 'function') {\n        this[names[i]] = error[names[i]];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EE.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = self.setImmediate || self.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = v4; // mimic old import, only v4 is ever used elsewhere\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EE);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EE.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EE);\n\nfunction AbstractPouchDB() {\n  EE.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EE();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EE.prototype).forEach(function (key) {\n    if (typeof EE.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.2.2\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-/.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function (e) {\n    var msg = e.target.error && e.target.error.message;\n\n    if (!msg) {\n      msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    } else if (msg.indexOf(\"stored database is a higher version\") !== -1) {\n      msg = new Error('This DB was created with the newer \"indexeddb\" adapter, but you are trying to open it with the older \"idb\" adapter');\n    }\n\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if ('buffer' in response) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            var typeFieldDescriptor = Object.getOwnPropertyDescriptor(blob.__proto__, 'type');\n            if (!typeFieldDescriptor || typeFieldDescriptor.set) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser && typeof response.buffer === 'function') {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EE);\nfunction Replication() {\n  EE.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EE);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js';\n\nfunction v4(options, buf, offset) {\n  if (typeof options === 'string') {\n    buf = options === 'binary' ? new Uint8Array(16) : null;\n    options = null;\n  }\n\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    var start = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[start + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return bytesToUuid(rnds);\n}\n\nexport default v4;","import lie from 'lie';\n\n/* istanbul ignore next */\nvar PouchPromise = typeof Promise === 'function' ? Promise : lie;\n\nexport default PouchPromise;\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n/* global Map,Set */\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","import getArguments from 'argsarray';\nimport Promise from 'pouchdb-promise';\nimport { Map } from 'pouchdb-collections';\nimport immediate from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nfunction isChromeApp() {\n  return (typeof chrome !== \"undefined\" &&\n    typeof chrome.storage !== \"undefined\" &&\n    typeof chrome.storage.local !== \"undefined\");\n}\n\nvar hasLocal;\n\nif (isChromeApp()) {\n  hasLocal = false;\n} else {\n  try {\n    localStorage.setItem('_pouch_check_localstorage', 1);\n    hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n  } catch (e) {\n    hasLocal = false;\n  }\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n// avoid using process.nextTick() directly because the polyfill is very large and we don't\n// need all of it (see: https://github.com/defunctzombie/node-process).\n// \"immediate\" 3.0.8 is used by lie, and it's a smaller version of the latest \"immediate\"\n// package, so it's the one we use.\n// When we use nextTick() in our codebase, we only care about not releasing Zalgo\n// (see: http://blog.izs.me/post/59142742143/designing-apis-for-asynchrony).\n// Microtask vs macrotask doesn't matter to us. So we're free to use the fastest\n// (least latency) option, which is \"immediate\" due to use of microtasks.\n// All of our nextTicks are isolated to this one function so we can easily swap out one\n// implementation for another.\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (isChromeApp()) {\n    chrome.storage.onChanged.addListener(function (e) {\n      // make sure it's event addressed to us\n      if (e.db_name != null) {\n        //object only has oldValue, newValue members\n        self.emit(e.dbName.newValue);\n      }\n    });\n  } else if (hasLocalStorage()) {\n    if (typeof addEventListener !== 'undefined') {\n      addEventListener(\"storage\", function (e) {\n        self.emit(e.key);\n      });\n    } else { // old IE\n      window.attachEvent(\"storage\", function (e) {\n        self.emit(e.key);\n      });\n    }\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (isChromeApp()) {\n    chrome.storage.local.set({dbName: dbName});\n  } else if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    return fun.toString().match(/^\\s*function\\s*(\\S*)\\s*\\(/)[1];\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\nfunction isCordova() {\n  return (typeof cordova !== \"undefined\" ||\n  typeof PhoneGap !== \"undefined\" ||\n  typeof phonegap !== \"undefined\");\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n// designed to opt-in to certain optimizations, such as\n// avoiding checks for \"dependentDbs\" and other things that\n// we know only apply to local databases. In general, \"remote\"\n// should be true for the http adapter, and for third-party\n// adapters with similar expensive boundaries to cross for\n// every API call, such as socket-pouch and worker-pouch.\n// Previously, this was handled via db.type() === 'http'\n// which is now deprecated.\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev() {\n  return uuidV4.v4().replace(/-/g, '').toLowerCase();\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isChromeApp, isCordova, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import Promise from 'pouchdb-promise';\nimport { blob, readAsArrayBuffer } from 'pouchdb-binary-utils';\nimport { assign, clone } from 'pouchdb-utils';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\n\n/* global fetch */\n/* global Headers */\nfunction wrappedFetch() {\n  var wrappedPromise = {};\n\n  var promise = new Promise(function (resolve, reject) {\n    wrappedPromise.resolve = resolve;\n    wrappedPromise.reject = reject;\n  });\n\n  var args = new Array(arguments.length);\n\n  for (var i = 0; i < args.length; i++) {\n    args[i] = arguments[i];\n  }\n\n  wrappedPromise.promise = promise;\n\n  Promise.resolve().then(function () {\n    return fetch.apply(null, args);\n  }).then(function (response) {\n    wrappedPromise.resolve(response);\n  }).catch(function (error) {\n    wrappedPromise.reject(error);\n  });\n\n  return wrappedPromise;\n}\n\nfunction fetchRequest(options, callback) {\n  var wrappedPromise, timer, response;\n\n  var headers = new Headers();\n\n  var fetchOptions = {\n    method: options.method,\n    credentials: 'include',\n    headers: headers\n  };\n\n  if (options.json) {\n    headers.set('Accept', 'application/json');\n    headers.set('Content-Type', options.headers['Content-Type'] ||\n      'application/json');\n  }\n\n  if (options.body &&\n      options.processData &&\n      typeof options.body !== 'string') {\n    fetchOptions.body = JSON.stringify(options.body);\n  } else if ('body' in options) {\n    fetchOptions.body = options.body;\n  } else {\n    fetchOptions.body = null;\n  }\n\n  Object.keys(options.headers).forEach(function (key) {\n    if (options.headers.hasOwnProperty(key)) {\n      headers.set(key, options.headers[key]);\n    }\n  });\n\n  wrappedPromise = wrappedFetch(options.url, fetchOptions);\n\n  if (options.timeout > 0) {\n    timer = setTimeout(function () {\n      wrappedPromise.reject(new Error('Load timeout for resource: ' +\n        options.url));\n    }, options.timeout);\n  }\n\n  wrappedPromise.promise.then(function (fetchResponse) {\n    response = {\n      statusCode: fetchResponse.status\n    };\n\n    if (options.timeout > 0) {\n      clearTimeout(timer);\n    }\n\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      return options.binary ? fetchResponse.blob() : fetchResponse.text();\n    }\n\n    return fetchResponse.json();\n  }).then(function (result) {\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      callback(null, response, result);\n    } else {\n      result.status = response.statusCode;\n      callback(result);\n    }\n  }).catch(function (error) {\n    if (!error) {\n      // this happens when the listener is canceled\n      error = new Error('canceled');\n    }\n    callback(error);\n  });\n\n  return {abort: wrappedPromise.reject};\n}\n\nfunction xhRequest(options, callback) {\n\n  var xhr, timer;\n  var timedout = false;\n\n  var abortReq = function () {\n    xhr.abort();\n    cleanUp();\n  };\n\n  var timeoutReq = function () {\n    timedout = true;\n    xhr.abort();\n    cleanUp();\n  };\n\n  var ret = {abort: abortReq};\n\n  var cleanUp = function () {\n    clearTimeout(timer);\n    ret.abort = function () {};\n    if (xhr) {\n      xhr.onprogress = undefined;\n      if (xhr.upload) {\n        xhr.upload.onprogress = undefined;\n      }\n      xhr.onreadystatechange = undefined;\n      xhr = undefined;\n    }\n  };\n\n  if (options.xhr) {\n    xhr = new options.xhr();\n  } else {\n    xhr = new XMLHttpRequest();\n  }\n\n  try {\n    xhr.open(options.method, options.url);\n  } catch (exception) {\n    return callback(new Error(exception.name || 'Url is invalid'));\n  }\n\n  xhr.withCredentials = ('withCredentials' in options) ?\n    options.withCredentials : true;\n\n  if (options.method === 'GET') {\n    delete options.headers['Content-Type'];\n  } else if (options.json) {\n    options.headers.Accept = 'application/json';\n    options.headers['Content-Type'] = options.headers['Content-Type'] ||\n      'application/json';\n    if (options.body &&\n        options.processData &&\n        typeof options.body !== \"string\") {\n      options.body = JSON.stringify(options.body);\n    }\n  }\n\n  if (options.binary) {\n    xhr.responseType = 'arraybuffer';\n  }\n\n  if (!('body' in options)) {\n    options.body = null;\n  }\n\n  for (var key in options.headers) {\n    if (options.headers.hasOwnProperty(key)) {\n      xhr.setRequestHeader(key, options.headers[key]);\n    }\n  }\n\n  if (options.timeout > 0) {\n    timer = setTimeout(timeoutReq, options.timeout);\n    xhr.onprogress = function () {\n      clearTimeout(timer);\n      if (xhr.readyState !== 4) {\n        timer = setTimeout(timeoutReq, options.timeout);\n      }\n    };\n    if (typeof xhr.upload !== 'undefined') { // does not exist in ie9\n      xhr.upload.onprogress = xhr.onprogress;\n    }\n  }\n\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    var response = {\n      statusCode: xhr.status\n    };\n\n    if (xhr.status >= 200 && xhr.status < 300) {\n      var data;\n      if (options.binary) {\n        data = blob([xhr.response || ''], {\n          type: xhr.getResponseHeader('Content-Type')\n        });\n      } else {\n        data = xhr.responseText;\n      }\n      callback(null, response, data);\n    } else {\n      var err = {};\n      if (timedout) {\n        err = new Error('ETIMEDOUT');\n        err.code = 'ETIMEDOUT';\n      } else if (typeof xhr.response === 'string' && xhr.response !== '') {\n        try {\n          err = JSON.parse(xhr.response);\n        } catch (e) {}\n      }\n\n      err.status = xhr.status;\n\n      callback(err);\n    }\n    cleanUp();\n  };\n\n  if (options.body && (options.body instanceof Blob)) {\n    readAsArrayBuffer(options.body, function (arrayBuffer) {\n      xhr.send(arrayBuffer);\n    });\n  } else {\n    xhr.send(options.body);\n  }\n\n  return ret;\n}\n\nfunction testXhr() {\n  try {\n    new XMLHttpRequest();\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n\nvar hasXhr = testXhr();\n\nfunction ajax(options, callback) {\n  if (!false && (hasXhr || options.xhr)) {\n    return xhRequest(options, callback);\n  } else {\n    return fetchRequest(options, callback);\n  }\n}\n\n// the blob already has a type; do nothing\n\nfunction defaultBody() {\n  return '';\n}\n\nfunction ajaxCore(options, callback) {\n\n  options = clone(options);\n\n  var defaultOptions = {\n    method : \"GET\",\n    headers: {},\n    json: true,\n    processData: true,\n    timeout: 10000,\n    cache: false\n  };\n\n  options = assign(defaultOptions, options);\n\n  function onSuccess(obj, resp, cb) {\n    if (!options.binary && options.json && typeof obj === 'string') {\n      /* istanbul ignore next */\n      try {\n        obj = JSON.parse(obj);\n      } catch (e) {\n        // Probably a malformed JSON from server\n        return cb(e);\n      }\n    }\n    if (Array.isArray(obj)) {\n      obj = obj.map(function (v) {\n        if (v.error || v.missing) {\n          return generateErrorFromResponse(v);\n        } else {\n          return v;\n        }\n      });\n    }\n    if (options.binary) {\n      \n    }\n    cb(null, obj, resp);\n  }\n\n  if (options.json) {\n    if (!options.binary) {\n      options.headers.Accept = 'application/json';\n    }\n    options.headers['Content-Type'] = options.headers['Content-Type'] ||\n      'application/json';\n  }\n\n  if (options.binary) {\n    options.encoding = null;\n    options.json = false;\n  }\n\n  if (!options.processData) {\n    options.json = false;\n  }\n\n  return ajax(options, function (err, response, body) {\n\n    if (err) {\n      return callback(generateErrorFromResponse(err));\n    }\n\n    var error;\n    var content_type = response.headers && response.headers['content-type'];\n    var data = body || defaultBody();\n\n    // CouchDB doesn't always return the right content-type for JSON data, so\n    // we check for ^{ and }$ (ignoring leading/trailing whitespace)\n    if (!options.binary && (options.json || !options.processData) &&\n        typeof data !== 'object' &&\n        (/json/.test(content_type) ||\n         (/^[\\s]*\\{/.test(data) && /\\}[\\s]*$/.test(data)))) {\n      try {\n        data = JSON.parse(data.toString());\n      } catch (e) {}\n    }\n\n    if (response.statusCode >= 200 && response.statusCode < 300) {\n      onSuccess(data, response, callback);\n    } else {\n      error = generateErrorFromResponse(data);\n      error.status = response.statusCode;\n      callback(error);\n    }\n  });\n}\n\nfunction ajax$1(opts, callback) {\n\n  // cache-buster, specifically designed to work around IE's aggressive caching\n  // see http://www.dashbay.com/2011/05/internet-explorer-caches-ajax/\n  // Also Safari caches POSTs, so we need to cache-bust those too.\n  var ua = (navigator && navigator.userAgent) ?\n    navigator.userAgent.toLowerCase() : '';\n\n  var isSafari = ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1;\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n\n  // it appears the new version of safari also caches GETs,\n  // see https://github.com/pouchdb/pouchdb/issues/5010\n  var shouldCacheBust = (isSafari ||\n    ((isIE || isTrident || isEdge) && opts.method === 'GET'));\n\n  var cache = 'cache' in opts ? opts.cache : true;\n\n  var isBlobUrl = /^blob:/.test(opts.url); // don't append nonces for blob URLs\n\n  if (!isBlobUrl && (shouldCacheBust || !cache)) {\n    var hasArgs = opts.url.indexOf('?') !== -1;\n    opts.url += (hasArgs ? '&' : '?') + '_nonce=' + Date.now();\n  }\n\n  return ajaxCore(opts, callback);\n}\n\nexport default ajax$1;\n","var thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  if (typeof FileReader === 'undefined') {\n    // fix for Firefox in a web worker\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=901097\n    return callback(arrayBufferToBinaryString(\n      new FileReaderSync().readAsArrayBuffer(blob)));\n  }\n\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  if (typeof FileReader === 'undefined') {\n    // fix for Firefox in a web worker:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=901097\n    return callback(new FileReaderSync().readAsArrayBuffer(blob));\n  }\n\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\nfunction typedBuffer() {\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBinaryString as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","import urlJoin from 'url-join';\nimport urlParse from 'url-parse';\nimport inherits from 'inherits';\nimport { btoa } from 'pouchdb-binary-utils';\nimport ajaxCore from 'pouchdb-ajax';\nimport { assign, toPromise, clone } from 'pouchdb-utils';\nimport Promise from 'pouchdb-promise';\n\nfunction getBaseUrl(db) {\n  // Parse database url\n  var url;\n  if (typeof db.getUrl === 'function') { // pouchdb pre-6.0.0\n    url = urlParse(db.getUrl());\n  } else { // pouchdb post-6.0.0\n    // Use PouchDB.defaults' prefix, if any\n    var prefix = db.__opts && db.__opts.prefix ? db.__opts.prefix + '/' : '';\n    url = urlParse(prefix + db.name);\n  }\n\n  // Compute parent path for databases not hosted on domain root (see #215)\n  var path = url.pathname;\n  path = path.substr(-1, 1) === '/' ? path.substr(0, -1) : path;\n  var parentPath = path.split('/').slice(0, -1).join('/');\n\n  return url.origin + parentPath;\n}\n\nfunction getConfigUrl(db, nodeName) {\n  return urlJoin(getBaseUrl(db), (nodeName ? '/_node/' + nodeName : '') + '/_config');\n}\n\nfunction getUsersUrl(db) {\n  return urlJoin(getBaseUrl(db), '/_users');\n}\n\nfunction getSessionUrl(db) {\n  return urlJoin(getBaseUrl(db), '/_session');\n}\n\nfunction getBasicAuthHeaders(db) {\n  var auth;\n\n  if (db.__opts.auth) {\n    auth = db.__opts.auth;\n  } else {\n    var url = urlParse(db.name);\n    if (url.auth) {\n      auth = url;\n    }\n  }\n\n  if (!auth) {\n    return {};\n  }\n\n  var str = auth.username + ':' + auth.password;\n  var token = btoa(unescape(encodeURIComponent(str)));\n  return {Authorization: 'Basic ' + token};\n}\n\nfunction wrapError(callback) {\n  // provide more helpful error message\n  return function (err, res) {\n    if (err) {\n      if (err.name === 'unknown_error') {\n        err.message = (err.message || '') +\n            ' Unknown error!  Did you remember to enable CORS?';\n      }\n    }\n    return callback(err, res);\n  };\n}\n\nfunction AuthError(message) {\n  this.status = 400;\n  this.name = 'authentication_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, AuthError);\n  } catch (e) {}\n}\n\ninherits(AuthError, Error);\n\nvar getMembership = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n\n  var url = getBaseUrl(db) + '/_membership';\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar signUpAdmin = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  db.getMembership(opts, function (error, membership) {\n    var nodeName;\n    if (error) {\n      if (error.error !== 'illegal_database_name') {\n        return callback(error);\n      } else {\n        // Some couchdb-1.x-like server\n        nodeName = undefined;\n      }\n    } else {\n      // Some couchdb-2.x-like server\n      nodeName = membership.all_nodes[0];\n    }\n\n    var configUrl = getConfigUrl(db, nodeName);\n    var url = (opts.configUrl || configUrl) + '/admins/' + encodeURIComponent(username);\n    var ajaxOpts = assign({\n      method: 'PUT',\n      url: url,\n      processData: false,\n      headers: getBasicAuthHeaders(db),\n      body: '\"' + password + '\"',\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar deleteAdmin = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getMembership(opts, function (error, membership) {\n    var nodeName;\n    if (error) {\n      if (error.error !== 'illegal_database_name') {\n        return callback(error);\n      } else {\n        // Some couchdb-1.x-like server\n        nodeName = undefined;\n      }\n    } else {\n      // Some couchdb-2.x-like server\n      nodeName = membership.all_nodes[0];\n    }\n\n    var configUrl = getConfigUrl(db, nodeName);\n    var url = (opts.configUrl || configUrl) + '/admins/' + encodeURIComponent(username);\n    var ajaxOpts = assign({\n      method: 'DELETE',\n      url: url,\n      processData: false,\n      headers: getBasicAuthHeaders(db),\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar logIn = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('this plugin only works for the http/https adapter'));\n  }\n\n  if (!username) {\n    return callback(new AuthError('you must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('you must provide a password'));\n  }\n\n  var ajaxOpts = assign({\n    method: 'POST',\n    url: getSessionUrl(db),\n    headers: assign({'Content-Type': 'application/json'}, getBasicAuthHeaders(db)),\n    body: {name: username, password: password},\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar logOut = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  var ajaxOpts = assign({\n    method: 'DELETE',\n    url: getSessionUrl(db),\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar getSession = toPromise(function (opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  var url = getSessionUrl(db);\n\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar getUsersDatabaseUrl = function () {\n  var db = this;\n  return getUsersUrl(db);\n};\n\nfunction updateUser(db, user, opts, callback) {\n  var reservedWords = [\n    '_id',\n    '_rev',\n    'name',\n    'type',\n    'roles',\n    'password',\n    'password_scheme',\n    'iterations',\n    'derived_key',\n    'salt' ];\n\n  if (opts.metadata) {\n    for (var key in opts.metadata) {\n      if (opts.metadata.hasOwnProperty(key) && reservedWords.indexOf(key) !== -1) {\n        return callback(new AuthError('cannot use reserved word in metadata: \"' + key + '\"'));\n      }\n    }\n    user = assign(user, opts.metadata);\n  }\n\n  if (opts.roles) {\n    user = assign(user, {roles: opts.roles});\n  }\n\n  var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n  var ajaxOpts = assign({\n    method: 'PUT',\n    url: url,\n    body: user,\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n}\n\nvar signUp = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  var userId = 'org.couchdb.user:' + username;\n  var user = {\n    name: username,\n    password: password,\n    roles: [],\n    type: 'user',\n    _id: userId,\n  };\n\n  updateUser(db, user, opts, callback);\n});\n\nvar getUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (!username) {\n    return callback(new AuthError('you must provide a username'));\n  }\n\n  var url = getUsersUrl(db);\n  var ajaxOpts = assign({\n    method: 'GET',\n    url: url + '/' + encodeURIComponent('org.couchdb.user:' + username),\n    headers: getBasicAuthHeaders(db),\n  }, opts.ajax || {});\n  ajaxCore(ajaxOpts, wrapError(callback));\n});\n\nvar putUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    updateUser(db, user, opts, callback);\n  });\n});\n\nvar deleteUser = toPromise(function (username, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? username : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id) + '?rev=' + user._rev;\n    var ajaxOpts = assign({\n      method: 'DELETE',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar changePassword = toPromise(function (username, password, opts, callback) {\n  var db = this;\n  if (typeof callback === 'undefined') {\n    callback = typeof opts === 'undefined' ? (typeof password === 'undefined' ?\n      username : password) : opts;\n    opts = {};\n  }\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  } else if (!username) {\n    return callback(new AuthError('You must provide a username'));\n  } else if (!password) {\n    return callback(new AuthError('You must provide a password'));\n  }\n\n  db.getUser(username, opts, function (error, user) {\n    if (error) {\n      return callback(error);\n    }\n\n    user.password = password;\n\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n    var ajaxOpts = assign({\n      method: 'PUT',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n      body: user,\n    }, opts.ajax || {});\n    ajaxCore(ajaxOpts, wrapError(callback));\n  });\n});\n\nvar changeUsername = toPromise(function (oldUsername, newUsername, opts, callback) {\n  var db = this;\n  var USERNAME_PREFIX = 'org.couchdb.user:';\n  var ajax = function (opts) {\n    return new Promise(function (resolve, reject) {\n      ajaxCore(opts, wrapError(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      }));\n    });\n  };\n  var updateUser = function (user, opts) {\n    var url = getUsersUrl(db) + '/' + encodeURIComponent(user._id);\n    var updateOpts = assign({\n      method: 'PUT',\n      url: url,\n      headers: getBasicAuthHeaders(db),\n      body: user,\n    }, opts.ajax);\n    return ajax(updateOpts);\n  };\n  if (typeof callback === 'undefined') {\n    callback = opts;\n    opts = {};\n  }\n  opts.ajax = opts.ajax || {};\n  if (['http', 'https'].indexOf(db.type()) === -1) {\n    return callback(new AuthError('This plugin only works for the http/https adapter. ' +\n      'So you should use new PouchDB(\"http://mysite.com:5984/mydb\") instead.'));\n  }\n  if (!newUsername) {\n    return callback(new AuthError('You must provide a new username'));\n  }\n  if (!oldUsername) {\n    return callback(new AuthError('You must provide a username to rename'));\n  }\n\n  db.getUser(newUsername, opts)\n  .then(function () {\n    var error = new AuthError('user already exists');\n    error.taken = true;\n    throw error;\n  }, function () {\n    return db.getUser(oldUsername, opts);\n  })\n  .then(function (user) {\n    var newUser = clone(user);\n    delete newUser._rev;\n    newUser._id = USERNAME_PREFIX + newUsername;\n    newUser.name = newUsername;\n    newUser.roles = opts.roles || user.roles || {};\n    return updateUser(newUser, opts).then(function () {\n      user._deleted = true;\n      return updateUser(user, opts);\n    });\n  }).then(function (res) {\n    callback(null, res);\n  }).catch(callback);\n});\n\nvar plugin = {};\n\nplugin.login = logIn;\nplugin.logIn = logIn;\nplugin.logout = logOut;\nplugin.logOut = logOut;\nplugin.getSession = getSession;\n\nplugin.getMembership = getMembership;\nplugin.signUpAdmin = signUpAdmin;\nplugin.deleteAdmin = deleteAdmin;\n\nplugin.getUsersDatabaseUrl = getUsersDatabaseUrl;\nplugin.signup = signUp;\nplugin.signUp = signUp;\nplugin.getUser = getUser;\nplugin.putUser = putUser;\nplugin.deleteUser = deleteUser;\nplugin.changePassword = changePassword;\nplugin.changeUsername = changeUsername;\n\nif (typeof window !== 'undefined' && window.PouchDB) {\n  window.PouchDB.plugin(plugin);\n}\n\nexport default plugin;\n","import { Injectable } from '@angular/core';\n\n// TODO\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LoggingService {\n\n  constructor() { }\n\n  error(err: string) {\n    console.error(JSON.stringify(err));\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport PouchDB from 'pouchdb';\nimport PouchAuth from 'pouchdb-authentication';\nimport { Database, DBList, Doc, ExistingDoc } from '../../models/domain.model';\nimport { AuthService } from '../auth/auth.service';\nimport { EnvironmentService } from '../env/environment.service';\nimport { LoggingService } from '../logging.service';\nimport { BulkAddResponse } from '../../models/db/response.model';\nimport { from } from 'rxjs';\n\nPouchDB.plugin(PouchAuth);\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class PouchDBService {\n  private databases: DBList = {};\n\n  constructor(\n    private environment: EnvironmentService,\n    private logger: LoggingService,\n    private authService: AuthService,\n  ) {\n    Object.values(Database).forEach((dbName) => {\n      this.databases[dbName] = { name: dbName, listener: new EventEmitter() };\n    });\n  }\n\n  public instance(dbName: Database): PouchDB.Database<{}> | undefined {\n    if (this.getDBInstance(dbName)) return this.getDBInstance(dbName);\n    return (this.databases[dbName].instance = new PouchDB(this.databases[dbName].name));\n  }\n\n  private getDBInstance(dbName: Database): PouchDB.Database<{}> | undefined {\n    return this.databases[dbName]?.instance;\n  }\n\n  getRemoteDBInstance(dbName: Database): PouchDB.Database<{}> | undefined {\n    return this.databases[dbName]?.remoteInstance;\n  }\n\n  getChangeListener(dbName: Database): EventEmitter<any> | undefined {\n    return this.databases[dbName]?.listener || undefined;\n  }\n\n  async get(dbName: Database, id: string): Promise<any | undefined> {\n    try {\n      return await this.getDBInstance(dbName)?.get(id);\n    } catch (error) {\n      return this.getRemoteDBInstance(dbName)?.get(id);\n    }\n  }\n\n  /**\n   * Unlike other create/update actions, bulk updates are tried first on the remote if available\n   * for fail fast response directly from the SSOT.\n   * TODO reverse this behavior for cases with very large payloads\n  */\n  async addAll(dbName: Database, docs: Doc[]): Promise<BulkAddResponse | undefined> {\n    const remoteDB = this.getRemoteDBInstance(dbName);\n    const localDB = this.instance(dbName);\n\n    if (!remoteDB) return localDB?.bulkDocs(docs);\n\n    try {\n      await remoteDB?.info(); // throws error with status: 404 if not available\n    } catch (error) {\n      return localDB?.bulkDocs(docs);\n    }\n\n    return remoteDB?.bulkDocs(docs);\n  }\n\n  async getAll(dbName: Database): Promise<any | undefined> {\n    const remoteDB = this.getRemoteDBInstance(dbName);\n    const localDB = this.instance(dbName);\n\n    if (localDB) return localDB.allDocs();\n\n    return remoteDB?.allDocs();\n  }\n\n  /**\n   * Use only when the id of the doc is not relevant for its access patterns/queries\n  */\n  async createUsingPost(dbName: Database, doc: Doc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      return await dbInstance?.post(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  /**\n   * Use this in most cases for creating a doc and make sure to assign a unique _id field yourself.\n  */\n  async create(dbName: Database, doc: ExistingDoc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      return await dbInstance?.put(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  /**\n   * Use when updating a doc whose current revision string is not known yet or is likely to have changed.\n  */\n  async update(dbName: Database, doc: ExistingDoc): Promise<any> {\n    const dbInstance = this.getDBInstance(dbName);\n    try {\n      const result = await this.get(dbName, doc._id);\n      doc._rev = result._rev;\n      return dbInstance?.put(doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  async delete(dbName: Database, doc: ExistingDoc): Promise<any> {\n    try {\n      const result = await this.get(dbName, doc._id);\n      doc._rev = result._rev;\n      doc._deleted = true;\n      return this.update(dbName, doc);\n    } catch (error) {\n      return new Promise((_, reject) => reject(error));\n    }\n  }\n\n  remoteLogin(dbName: Database): PouchDB.Database<{}> | undefined {\n    if (this.getRemoteDBInstance(dbName)) return this.getRemoteDBInstance(dbName);\n\n    const remoteDB = new PouchDB(`${this.environment.dbUri}/${dbName}`, {\n      skip_setup: true,\n    });\n\n    if (!this?.authService?.isAuthenticated) return this.getRemoteDBInstance(dbName);\n\n    from(remoteDB.logIn(this.authService?.user, this.authService?.pass)).subscribe(_ => {\n      this.databases[dbName].remoteInstance = remoteDB;\n    });\n\n    return this.getRemoteDBInstance(dbName);\n  }\n\n  remoteSync(dbName: Database): EventEmitter<any> | undefined {\n    if (this.getRemoteDBInstance(dbName)) return this.getChangeListener(dbName);\n\n    const dbMeta = this.databases[dbName];\n    const remoteDB = new PouchDB(`${this.environment.dbUri}/${dbName}`, {\n      skip_setup: true,\n    });\n\n    if (!this.authService.isAuthenticated) return this.getChangeListener(dbName);\n\n    const localDB = dbMeta.instance ? dbMeta.instance : this.instance(dbName);\n\n    const emitOnChange = (change: any) => dbMeta?.listener?.emit(change);\n\n    from(remoteDB.logIn(this.authService?.user, this.authService?.pass))\n        .subscribe(_ => {\n\n          this.databases[dbName].remoteInstance = remoteDB;\n\n          localDB?.sync(remoteDB, { live: true })\n            .on('change', emitOnChange)\n            .on('complete', emitOnChange)\n            .on('error', (err: any) => this.logger.error(err));\n\n          this.databases[dbName].listener = dbMeta.listener;\n        });\n\n    return dbMeta.listener;\n  }\n}\n","import { EventEmitter, Injectable } from '@angular/core';\nimport { Database, ExistingDoc, Doc } from '../../models/domain.model';\nimport { DBService } from './db.service.interface';\nimport { PouchDBService } from './pouchdb.service';\nimport { AllDocs } from '../../models/db/all-docs.model';\nimport { BulkAddResponse } from '../../models/db/response.model';\nimport { RETTupleRev } from '../../models/db/table-headers.model';\nimport { PSchema } from '../../models/db/schema/pschema.model';\n\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ReturneeService implements DBService {\n\n  private returneeDB = Database.returnees;\n\n  private returneeHeaders_: string[][];\n\n  constructor(private dbService: PouchDBService) {\n    this.instance();\n    this.remoteSync();\n  }\n\n  instance(): PouchDB.Database<{}> | undefined {\n    return this.dbService.instance(this.returneeDB);\n  }\n\n  get headers(): string[][] { return this.returneeHeaders_; }\n\n  async getAll(startkey = 'province:', endkey = 'province:\\ufff0'): Promise<AllDocs.Root | undefined> {\n    const requestQuery = {\n      include_docs: true,\n      startkey,\n      endkey,\n      limit: 800,\n    };\n    const locAllDocs = await this.instance()?.allDocs(requestQuery) as AllDocs.Root;\n\n    if (locAllDocs?.rows?.length !== 0) return locAllDocs;\n\n    return await this.dbService?.getRemoteDBInstance(this.returneeDB)?.allDocs(requestQuery) as AllDocs.Root;\n  }\n\n  async addAll(docs: Doc[]): Promise<BulkAddResponse | undefined> {\n    return this.dbService.addAll(this.returneeDB, docs);\n  }\n\n  async getAllWards(): Promise<Array<RETTupleRev> | undefined> {\n    try {\n      const response = await this.getAll();\n      return response?.rows?.map(row => [...row?.doc?.fields, row?.doc?._rev] as unknown as RETTupleRev);\n    } catch (error) {\n      throw Error('Ward-wise Returnee data could not be fetched');\n    }\n  }\n\n  async getTableHeaders(current = 'pschema:returnees:v8'): Promise<string[][]> {\n    // TODO put data from pschema:pcrs:v8.ts if not found on the remote db\n    if (this.returneeHeaders_) return Promise.resolve(this.returneeHeaders_);\n    try {\n      const response = await this.get(current) as PSchema;\n      return (this.returneeHeaders_ = response.fields);\n    } catch (error) {\n      throw Error('Returnee data table headers could not be fetched');\n    }\n  }\n\n\n  remoteSync(): EventEmitter<any> | undefined {\n    return this.dbService?.remoteSync(this.returneeDB);\n  }\n\n  getChangeListener(): EventEmitter<any> | undefined {\n    return this.dbService?.getChangeListener(this.returneeDB);\n  }\n\n  get(id: string): Promise<any> | undefined {\n    return this.dbService.get(this.returneeDB, id);\n  }\n\n  create(doc: ExistingDoc): Promise<any> {\n    return this.dbService.create(this.returneeDB, doc);\n  }\n\n  update(doc: ExistingDoc): Promise<any> {\n    return this.dbService.update(this.returneeDB, doc);\n  }\n\n  delete(doc: ExistingDoc): Promise<any> {\n    return this.dbService.delete(this.returneeDB, doc);\n  }\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  return decodeURIComponent(input.replace(/\\+/g, ' '));\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  //\n  // Little nifty parsing hack, leverage the fact that RegExp.exec increments\n  // the lastIndex property so we can continue executing this loop until we've\n  // parsed all results.\n  //\n  for (;\n    part = parser.exec(query);\n    result[decode(part[1])] = decode(part[2])\n  );\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = [];\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict';\n\nexports.test = function () {\n  if (global.setImmediate) {\n    // we can only get here in IE10\n    // which doesn't handel postMessage well\n    return false;\n  }\n  return typeof global.MessageChannel !== 'undefined';\n};\n\nexports.install = function (func) {\n  var channel = new global.MessageChannel();\n  channel.port1.onmessage = func;\n  return function () {\n    channel.port2.postMessage(0);\n  };\n};","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n"]}